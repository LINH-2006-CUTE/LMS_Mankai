!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="e7700024-3098-4974-a9e0-c0ae487c5e53",e._sentryDebugIdIdentifier="sentry-dbid-e7700024-3098-4974-a9e0-c0ae487c5e53")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8419],{48419:function(e,t,n){n.r(t),n.d(t,{ChatError:function(){return nT},default:function(){return nR}});var s=n(2899),i=n(22136),a=n(75243),r=n(46520),o=n(43335),l=n(69492),d=n(76038),c=n(38372),u=n(6087),p=n(34116),m=n(49727),g=n(338),h=n(3848),v=n(19059),f=n(491),x=n(80606),b=n(61787),y=n(72837),I=n(97382),j=n(86015),S=n(90740),w=n(38112),E=n(16448),N=n(11849),C=n(69150),k=n(56735),_=n(65826),M=n(94908),R=n(45870),T=n(77012),Z=n(92311),O=n(16074),A=n(87048),U=n(66564),L=n(22054),z=n(88205),P=n(78617),D=n(89642),G=n(97386),K=n(53388),H=n(63590),B=n(13055),F=n(80831),W=n(48698),$=n(41239),q=n(70702),V=n(81211);function Y(){var e,t;let{t:n}=(0,q.$G)("base"),s=(0,V.g)(),i=Array.isArray(null===(t=s.EDIT_IMAGE_PRESETS)||void 0===t?void 0:null===(e=t.value)||void 0===e?void 0:e.presets)?s.EDIT_IMAGE_PRESETS.value.presets:[];return{editImagePresets:X.map(e=>({...e,label:n("edit-image-presets.categories.".concat(e.category)),presets:e.presets.map(e=>{var t,s;return{...e,label:n("edit-image-presets.presets.".concat(e.presetId)),prompt:null!==(s=null===(t=i.find(t=>t.presetId===e.presetId))||void 0===t?void 0:t.prompt)&&void 0!==s?s:""}})})).filter(e=>e.presets.some(e=>e.prompt)).map(e=>({...e,presets:e.presets.filter(e=>e.prompt)}))}}let X=[{category:"creative",icon:m.Z,presets:[{presetId:"water-color",icon:g.Z},{presetId:"15th-century",icon:h.Z},{presetId:"graffiti",icon:v.Z},{presetId:"renaissance-painting",icon:f.Z},{presetId:"symbolist-painting",icon:x.Z},{presetId:"expressionist-painting",icon:b.Z},{presetId:"cubist-painting",icon:y.Z},{presetId:"ukiyo-e-painting",icon:I.Z},{presetId:"bright-anime",icon:j.Z},{presetId:"dark-anime",icon:S.Z},{presetId:"cyberpunk",icon:w.Z},{presetId:"retro-game",icon:E.Z}]},{category:"background",icon:N.Z,presets:[{presetId:"paris",icon:C.Z},{presetId:"london",icon:C.Z},{presetId:"tokyo",icon:C.Z},{presetId:"mars",icon:k.Z},{presetId:"tropical-paradise",icon:_.Z},{presetId:"cosmic-void",icon:M.Z},{presetId:"urban-rooftop",icon:C.Z},{presetId:"enchanted-cave",icon:R.Z},{presetId:"misty-forest",icon:T.Z},{presetId:"retro-arcade",icon:Z.Z},{presetId:"space-station",icon:O.Z},{presetId:"desert-oasis",icon:_.Z},{presetId:"volcano-lair",icon:A.Z},{presetId:"post-apocalypse",icon:U.Z}]},{category:"subject",icon:L.Z,presets:[{presetId:"stylish-hat",icon:z.Z},{presetId:"mustache",icon:P.Z},{presetId:"superhero-costume",icon:D.Z},{presetId:"golden-glow",icon:G.Z},{presetId:"mecha-warrior",icon:K.Z},{presetId:"sunglasses-jacket",icon:H.Z},{presetId:"medieval-armor",icon:B.Z},{presetId:"time-traveler",icon:F.Z},{presetId:"hologram-effect",icon:W.Z},{presetId:"dragon-rider",icon:A.Z},{presetId:"remove-people",icon:$.Z}]}];var J=n(89463),Q=n(89194),ee=n(74542),et=n(24823),en=n(73069),es=n(3667),ei=n(4694),ea=n(37446);let er=e=>{let{hasImage:t,prompt:n,onParentPeek:i,focusedImageUrl:a,parentImageUrl:r,isStreaming:o,onRegenerate:d,onClose:m}=e,{t:g}=(0,q.$G)("base"),[h,v]=(0,ei.useState)(!1),[f,x]=(0,ei.useState)(void 0),[b,y]=(0,ei.useState)(!1),I=(0,J.r)(),j=(0,l.gK)(e=>e.conversationId),S=(0,l.gK)(e=>e.lastMessageId),{editImagePresets:w}=Y(),E=(0,ei.useMemo)(()=>{if(!f)return;let e=w.flatMap(e=>e.presets).find(e=>e.prompt===f);return e?(0,s.jsxs)(s.Fragment,{children:[e.icon&&ei.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),(0,s.jsx)("h1",{className:"text-lg font-semibold truncate",children:e.label})]}):(0,s.jsx)("h1",{className:"text-lg font-semibold truncate",children:f})},[f,w]),N=(0,ei.useCallback)(()=>{!b&&a&&(y(!0),(0,Q.G)(a,null==a?void 0:a.split("/").pop()).catch((0,ee.n4)("image-editor:handleDownload")).finally(()=>y(!1)))},[a,b]);return(0,ei.useEffect)(()=>{n&&f!==n&&x(n)},[n,f]),(0,ei.useEffect)(()=>{r&&!h&&v(!0)},[r,h]),(0,s.jsx)("header",{className:"flex justify-between w-full items-center min-h-10 gap-3  relative z-30 flex-shrink-0",children:(0,s.jsxs)(en.M,{mode:"popLayout",children:[f&&(0,s.jsx)(es.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"flex items-center gap-2 w-full overflow-hidden min-w-0",children:E},f),(0,s.jsxs)("div",{className:"flex gap-2 ml-auto shrink-0",children:[(0,s.jsxs)(s.Fragment,{children:[h&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(es.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,s.jsx)(p.g$,{size:I?"iconLg":"iconXl",variant:"ghost","aria-label":g("Compare","Compare"),tooltipContent:g("Compare","Compare"),tooltipContentProps:{side:"bottom"},onMouseDown:()=>i(!0),onMouseUp:()=>i(!1),onMouseLeave:()=>i(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),i(!0)},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),i(!1)},onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},onContextMenuCapture:e=>{e.preventDefault(),e.stopPropagation()},asChild:!0,disabled:o||!r,children:(0,s.jsx)(es.E.button,{whileTap:!o&&r?{scale:.9}:void 0,children:(0,s.jsx)(et.Z,{className:"size-5"})})})},"compare"),(0,s.jsx)(es.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,s.jsx)(p.g$,{size:I?"iconLg":"iconXl",variant:"ghost","aria-label":g("Regenerate","Regenerate"),tooltipContent:g("Regenerate","Regenerate"),tooltipContentProps:{side:"bottom"},asChild:!0,disabled:o||!r,onClick:d,children:(0,s.jsx)(es.E.button,{whileTap:!o&&r?{scale:.9}:void 0,children:(0,s.jsx)(u.Iy,{className:"size-5"})})})},"regenerate")]}),t&&(0,s.jsx)(es.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,s.jsx)(p.g$,{variant:"ghost",size:I?"iconLg":"iconXl","aria-label":g("Download Image","Download Image"),tooltipContent:g("Download Image","Download Image"),tooltipContentProps:{side:"bottom"},disabled:o||!a||b,onClick:N,children:b?(0,s.jsx)(ea.$,{size:"xs"}):(0,s.jsx)(u._8,{className:"size-5"})})},"download"),j&&S&&(0,s.jsx)(es.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,s.jsx)(c.T,{variant:"ghost",size:I?"iconLg":"iconXl",conversationId:j,responseId:S,iconProps:{size:20}})},"share")]}),I?(0,s.jsx)(p.zx,{"aria-label":g("Close Image Editor","Close Image Editor"),variant:"primary",size:"iconLg",onClick:m,children:(0,s.jsx)(u.b0,{size:20})}):(0,s.jsx)(p.g$,{"aria-label":g("Close Image Editor","Close Image Editor"),tooltipContent:g("Close Image Editor","Close Image Editor"),tooltipContentProps:{side:"bottom"},variant:"primary",size:"lg",className:"rounded-full",onClick:m,children:g("Close","Close")})]})]})})};var eo=n(39502),el=n(72242);let ed=e=>{let{images:t,focusedOption:n,isStreaming:i,onSelect:a}=e;return(0,s.jsx)(es.E.aside,{className:"lg:fixed top-0 inset-0 lg:top-0 lg:right-0 lg:left-auto flex lg:flex-col items-center justify-center lg:h-full gap-4 pb-3 lg:p-6 pointer-events-none z-30",variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,s.jsx)(en.M,{children:t.map((e,t)=>(0,s.jsx)(es.E.button,{className:(0,el.cn)("size-16 sm:size-20 relative rounded-xl border bg-background p-1 pointer-events-auto",{"ring-primary ring-2":t===n}),onClick:()=>a(t),whileTap:t!==n?{scale:.95}:{},variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,s.jsx)("div",{className:"relative h-full w-full overflow-hidden rounded-lg",children:(0,s.jsx)("figure",{className:"absolute -translate-x-1/2 left-1/2 h-full aspect-[4/3]",children:(0,s.jsx)(eo.Z,{isModerated:e.isModerated,status:i?"streaming":"finished",iconSize:24,intermediateResults:i?e.progressMap:[{progress:1,imageUrl:e.url}]})})})},e.id))})},"image-editor-option-nav")};var ec=n(73197),eu=n(56672),ep=n(15571);let em=e=>{let{hasImage:t,inputValue:n,isStreaming:i,onInputValueChange:a,onSend:r,onAbort:o}=e,{t:d}=(0,q.$G)("base"),c=(0,l.gK)(eu.Z("lastMessageId")),p=(0,l.gK)(eu.Z("streamedMessageId")),m=(0,ec.CI)(eu.Z("byId")),g=(0,ei.useRef)(null),h=(0,ei.useRef)(null),[v,f]=(0,ei.useState)(!1),x=(0,ei.useMemo)(()=>i||!t,[i,t]),b=(0,ei.useMemo)(()=>!v&&!i&&t&&!!n.trim(),[v,t,n,i]),I=(0,ei.useCallback)(async e=>{var t;!x&&e.trim()&&(f(!0),await (null===(t=r(e))||void 0===t?void 0:t.finally(()=>{var e;null===(e=h.current)||void 0===e||e.focus(),f(!1)})))},[r,x]),j=(0,ei.useMemo)(()=>{let e=p?m[p]:void 0;if((null==e?void 0:e.parentResponseId)===c)return e},[p,m,c]),S=(0,ei.useMemo)(()=>{if(i)return(null==j?void 0:j.state)||"closed"},[i,j]),w=(0,ei.useCallback)(e=>{if(e.stopPropagation(),"Enter"===e.key&&!e.metaKey&&!e.ctrlKey&&!e.shiftKey&&!e.nativeEvent.isComposing){var t;e.preventDefault(),null===(t=g.current)||void 0===t||t.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}},[]);return(0,s.jsxs)("form",{className:"w-full rounded-[32px] p-3 bg-input-background shadow shadow-input-border/10 flex gap-2 pl-5 items-end ring-1 ring-input-border ring-inset",onSubmit:()=>I(n),ref:g,children:[(0,s.jsx)(ep.Z,{ref:h,className:(0,el.cn)("w-full @[480px]/input:px-3 bg-transparent focus:outline-none text-primary align-bottom resize-none pb-1.5",i&&"animate-pulse"),onChange:e=>a(e.target.value),value:n,placeholder:t?i?d("Editing image","Editing image"):d("Describe your edits","Describe your edits"):d("Upload an image to begin","Upload an image to begin"),minRows:1,onKeyDown:w,autoFocus:!0,disabled:x,name:"query",maxRows:5}),(0,s.jsx)("div",{className:(0,el.cn)("ml-auto flex flex-row items-end gap-1"),children:i&&("streaming"===S||"reconnecting"===S)?(0,s.jsx)(es.E.button,{whileTap:{scale:.95},initial:{scale:.95,opacity:1},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:.5,transition:{duration:.2}},className:(0,el.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),onClick:e=>{e.preventDefault(),o().catch(console.error)},children:(0,s.jsx)("div",{className:(0,el.cn)("h-9","aspect-square flex flex-col items-center justify-center rounded-full","rounded-full ring-1 ring-inset","bg-primary text-background ring-button-outline-border"),children:(0,s.jsx)(y.Z,{size:20})})}):(0,s.jsx)(es.E.button,{initial:{opacity:.5},animate:{opacity:1,transition:{duration:.1}},whileHover:t?{scale:1.1}:void 0,whileTap:t?{scale:.95}:void 0,className:(0,el.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),type:"submit","aria-label":d("Submit","Submit"),disabled:!b,children:(0,s.jsx)("div",{className:(0,el.cn)("h-9 relative","aspect-square flex flex-col items-center justify-center","rounded-full ring-1 ring-inset duration-100","before:absolute before:inset-0 before:rounded-full before:bg-primary before:ring-0 before:transition-all duration-500",b?"bg-primary text-background ring-transparent before: before:[clip-path:circle(50%_at_50%_50%)]":"bg-button-secondary text-secondary before:[clip-path:circle(0%_at_50%_50%)] ring-0"),children:(0,s.jsx)(u.Hf,{size:20,className:"relative"})})})})]})};var eg=n(83376),eh=n(87678),ev=n(50462),ef=n(49810),ex=n(3453),eb=n(41307),ey=n(10090),eI=n(43701),ej=n(74239),eS=n(75361),ew=n(76072);let eE=e=>{let{isEditingCurrentImage:t,setIsPeekingParent:n,isPeekingParent:i,focusedImage:a,parentImageUrl:r,generatedImageHeight:o,generatedImageWidth:l,isFinalImageLoaded:d,setIsFinalImageLoaded:c,isParentImageLoaded:u,setIsParentImageLoaded:p}=e,[m,g]=(0,ei.useState)([]),[h,v]=(0,ei.useState)(!1),[f,x]=(0,ei.useState)(!1),[b,y]=(0,ei.useState)(!0),I=(0,ei.useMemo)(()=>!!(o&&l),[o,l]),j=(0,ei.useMemo)(()=>o&&l?l/o:4/3,[o,l]);return(0,ei.useEffect)(()=>{(t||!b)&&(null==a?void 0:a.progressMap)?g(a.progressMap):!t&&(null==a?void 0:a.url)?g(e=>[...e,{progress:1,imageUrl:a.url||""}]):g([])},[t,null==a?void 0:a.url,null==a?void 0:a.progressMap,b]),(0,ei.useEffect)(()=>{if(!h){n(!1);return}let e=setTimeout(()=>{h&&!f&&n(!0)},100);return()=>clearTimeout(e)},[h,f,n]),(0,ei.useEffect)(()=>{t&&b&&y(!1),t||!d||b||y(!0)},[t,d,b]),(0,s.jsx)("figure",{className:(0,el.cn)("relative group/image w-full max-w-5xl 2xl:max-w-6xl overflow-hidden rounded-lg",!t&&r&&(i?"cursor-grabbing":"cursor-grab")),onDragStart:e=>{if(i){e.preventDefault();return}x(!0)},onDragEnd:()=>{x(!1),v(!1)},onMouseDown:e=>{0===e.button&&v(!0)},onMouseUp:()=>v(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),v(!0)},onTouchEnd:e=>{e.preventDefault(),v(!1)},onMouseLeave:()=>{v(!1),x(!1)},onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},onContextMenuCapture:e=>{e.preventDefault(),e.stopPropagation()},children:(0,s.jsx)(en.M,{mode:"wait",children:t||!b?I?(0,s.jsx)(es.E.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},exit:{opacity:1,filter:"blur(0px)",transition:{delay:1.5}},transition:{ease:"easeInOut"},className:"h-full mx-auto",style:{aspectRatio:j,maxHeight:o},children:(0,s.jsx)(eo.Z,{status:"streaming",intermediateResults:m,isModerated:null==a?void 0:a.isModerated,aspectRatio:j})},"streaming-image"):(0,s.jsx)(eN,{}):(0,s.jsxs)("div",{className:"flex relative items-center justify-center w-full h-full",children:[(null==a?void 0:a.url)&&(0,s.jsxs)(s.Fragment,{children:[!d&&(0,s.jsx)(eN,{className:"absolute z-20 inset-0"}),(0,s.jsx)(es.E.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},exit:"hidden",animate:r&&i||!d?"hidden":"visible",transition:{ease:"easeInOut"},src:a.url,alt:"active-image",className:"max-h-full aspect-auto rounded-lg",onLoad:()=>c(!0)},"finished-image")]}),(0,s.jsx)(en.M,{children:!t&&r&&i&&(0,s.jsxs)(es.E.div,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},initial:"hidden",exit:"hidden",animate:"visible",transition:{ease:"easeInOut"},className:"absolute z-10 w-full h-full flex items-center overflow-hidden",children:[!u&&(0,s.jsx)(eN,{className:"absolute z-20 inset-0"}),(0,s.jsx)(es.E.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},animate:u?"visible":"hidden",src:r,alt:"parent-image",className:"max-h-full aspect-auto mx-auto rounded-lg",onLoad:()=>p(!0)},"parent-image")]},"parent-image-container")})]})})})},eN=e=>{let{className:t}=e;return(0,s.jsx)(es.E.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{ease:"easeInOut"},className:(0,el.cn)("h-full w-full flex items-center justify-center animate-pulse-lg",t),children:(0,s.jsx)(ew.Z,{size:60,strokeWidth:1.3,className:"opacity-30 rotate-[-10deg]"})},"loader")};var eC=n(8781),ek=n(48972),e_=n(97404);let eM=e=>{let{hasImage:t,onSend:n,isStreaming:i}=e,{editImagePresets:a}=Y(),r=(0,eC.w)(),[o,l]=(0,ei.useState)(null),d=(0,ei.useMemo)(()=>i||!t,[i,t]),c=(0,ei.useCallback)(e=>{l(t=>t===e?null:e)},[r]),u=(0,ei.useCallback)(e=>{if(!i)return l(null),n(e.prompt,e.presetId)},[i,n]);return(0,s.jsx)("div",{className:"@container flex w-full xs:justify-center justify-start items-center overflow-x-auto xs:overflow-visible gap-2 xs:gap-3 relative z-30 no-scrollbar",children:a.map((e,t)=>(0,s.jsx)(es.E.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut",delay:.06*t},className:"bg-surface-base rounded-full",children:r?(0,s.jsxs)(ek.dy,{open:e.category===o,onOpenChange:t=>{t?l(e.category):l(null)},children:[(0,s.jsx)(ek.Qz,{disabled:d,asChild:!0,children:(0,s.jsx)(eR,{category:e,disabled:d})}),(0,s.jsxs)(ek.sc,{className:"max-h-[90dvh]",children:[(0,s.jsx)(ek.OX,{children:(0,s.jsxs)(ek.iI,{className:"flex items-center justify-center gap-2",children:[e.icon&&ei.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),e.label]})}),(0,s.jsx)("div",{className:"p-2 space-y-2 overflow-auto",children:e.presets.map(e=>(0,s.jsxs)(p.zx,{variant:"ghost",size:"lg",className:"w-full flex items-center justify-start gap-3 h-auto py-3",onClick:()=>u(e),children:[e.icon&&ei.createElement(e.icon,{size:18,className:"text-secondary flex-shrink-0"}),(0,s.jsx)("span",{children:e.label})]},e.presetId))})]})]}):(0,s.jsxs)(e_.h_,{open:e.category===o,onOpenChange:()=>c(e.category),children:[(0,s.jsx)(e_.$F,{disabled:d,asChild:!0,children:(0,s.jsx)(eR,{category:e,disabled:d})}),(0,s.jsx)(e_.AW,{hideWhenDetached:!0,side:"top",sideOffset:8,className:"min-w-60 space-y-0.5",onWheel:e=>e.stopPropagation(),children:e.presets.map(e=>(0,s.jsxs)(e_.Xi,{className:"flex items-center gap-2",onClick:()=>u(e),children:[e.icon&&ei.createElement(e.icon,{size:16,className:"text-secondary flex-shrink-0"}),e.label]},e.presetId))})]})},e.category))})},eR=ei.forwardRef((e,t)=>{let{category:n,disabled:i,...a}=e;return(0,s.jsxs)(p.zx,{ref:t,variant:"outline",size:"pill",className:(0,el.cn)("py-3 px-4 h-auto bg-surface-l2 dark:hover:bg-surface-l3 text-primary",!i&&"*:hover:text-primary transition-all"),disabled:i,...a,children:[n.icon&&ei.createElement(n.icon,{size:16,className:"flex-shrink-0 text-secondary transition-colors"}),(0,s.jsx)("span",{children:n.label})]})});var eT=n(53161),eZ=n(85286),eO=n(96934);let eA=e=>{let{onUploadImage:t}=e,{t:n}=(0,q.$G)("base"),i=(0,eb.O)(eu.Z("fetchUploadFile")),a=(0,eb.O)(eu.Z("removeByConversationId")),r=(0,l.gK)(eu.Z("conversationId")),{ASSET_SERVER_URL:o}=(0,d.O)(),c=(0,ei.useRef)(null),[u,m]=(0,ei.useState)(!1),[g,h]=(0,ei.useState)(!1),v=(0,ei.useCallback)(()=>{var e;null===(e=c.current)||void 0===e||e.click()},[]),f=(0,ei.useCallback)(async e=>{let s;if(1!==e.length){eS.Am.error(n("Only a single image file is allowed","Only a single image file is allowed"));return}if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(e[0].type)){eS.Am.error(n("Only image files are allowed","Only image files are allowed"));return}h(!0);try{let t=i(e[0],r||"no_conversation_id");s=await t.metadataPromise}catch(e){eS.Am.error(n("Failed to upload file","Failed to upload file"))}s instanceof Error&&eS.Am.error(n("Failed to upload file","Failed to upload file")),h(!1),a(r||"no_conversation_id"),!s||s instanceof Error||t({url:(0,ef.Vh)(o,s.fileUri),metadata:s})},[n,i,r,t,o,a]),x=(0,ei.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),g||m(!0)},[g]),b=(0,ei.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),m(!1)},[]),y=(0,ei.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),m(!1),!g)return f(Array.from(e.dataTransfer.files))},[f,g]),I=(0,ei.useCallback)(e=>{if(e.target.files)return f(Array.from(e.target.files)).finally(()=>{c.current&&(c.current.value="")})},[f]);return(0,s.jsx)(es.E.div,{initial:{opacity:0},animate:{opacity:1},onDragOver:x,onDragLeave:b,onDrop:y,className:"border resize transition-colors w-full max-w-7xl h-full flex justify-center items-center border-border-l1 rounded-2xl p-8 mb-3 text-center ".concat(u&&!g&&"bg-surface-l1 border-border-l1"),children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"p-4 rounded-full text-fg-secondary transition-colors bg-surface-l1",children:(0,s.jsx)(en.M,{mode:"popLayout",children:u&&!g?(0,s.jsx)(es.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,s.jsx)(eT.Z,{className:"size-6"})},"files"):(0,s.jsx)(es.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,s.jsx)(eZ.Z,{className:"size-6"})},"image-plus")})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-primary",children:n("Upload an image to begin","Upload an image to begin")}),(0,s.jsx)(en.M,{mode:"popLayout",children:g?(0,s.jsx)(es.E.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:n("Uploading image","Uploading image")},"uploading"):u?(0,s.jsx)(es.E.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:n("Drop image here","Drop image here")},"dragging"):(0,s.jsx)(es.E.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:n("Drag and drop to upload","Drag and drop to upload")},"not-dragging")})]}),(0,s.jsx)("div",{className:"flex gap-3",children:(0,s.jsxs)(p.zx,{variant:"outline",className:"text-fg-primary hover:bg-button-ghost-hover rounded-2xl transition-all py-2.5 px-4 h-auto *:hover:text-fg-primary *:hover:transition-colors",disabled:g,autoFocus:!0,onClick:v,children:[g?(0,s.jsx)(ea.$,{size:"xxs"}):(0,s.jsx)(eO.Z,{className:"size-4 text-fg-secondary"}),n("Upload","Upload")]})}),(0,s.jsx)("input",{ref:c,className:"hidden",type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:I,multiple:!1,"data-testid":"file-input"})]})})},eU=()=>{var e;let{ASSET_SERVER_URL:t}=(0,d.O)(),n=(0,V.g)(),{client:i}=(0,ej.useStatsigClient)(),{t:a}=(0,q.$G)("base"),r=(0,eg.X)(),{handleSendStart:o,timeToSendStart:c,streamingTimeStart:u,handleStreamingStart:p,consumeTimeToSendMs:m,consumeStreamingTimeMs:g,reset:h}=(0,eh.t)(),[v,f]=(0,ev._)("image-editor-first-open",!0),x=(0,ey.i)(eu.Z("isOpen")),b=(0,ey.i)(eu.Z("currentImage")),y=(0,ey.i)(eu.Z("setImage")),I=(0,l.gK)(eu.Z("conversationId")),j=(0,l.gK)(eu.Z("streamedMessageId")),S=(0,l.gK)(eu.Z("lastMessageId")),w=(0,ec.CI)(e=>e.byId[null!=j?j:""]),E=(0,ec.CI)(eu.Z("byId")),N=null!==(e=(0,ec.CI)(e=>e.byConversationId[null!=I?I:""]))&&void 0!==e?e:[],[C,k]=(0,ei.useState)(""),[_,M]=(0,ei.useState)(!1),[R,T]=(0,ei.useState)(null),[Z,O]=(0,ei.useState)(!1),[A,U]=(0,ei.useState)(!1),[L,z]=(0,ei.useState)(!1),[P,D]=(0,ei.useState)(!1),[G,K]=(0,ei.useState)(!1),H=(0,ei.useMemo)(()=>!!b,[b]),B=(0,ei.useMemo)(()=>!!(b&&"key"in b),[b]),F=(0,ei.useMemo)(()=>!!(b&&"metadata"in b),[b]),W=(0,ei.useMemo)(()=>{if(B)return _?(!R&&w&&T(w.responseId),w||E[null!=R?R:""]):N.filter(e=>e.streamingImageById).find(e=>{for(let t in e.streamingImageById){let n=e.streamingImageById[t][100];if((null==n?void 0:n.imageUrl)===(null==b?void 0:b.url))return!0}})||(null==N?void 0:N.find(e=>{var t,n;return null===(t=e.generatedImageUrls)||void 0===t?void 0:t.includes(null!==(n=b.assetKey)&&void 0!==n?n:"")}))},[b,N,B,_,w,R,E]),$=(0,ei.useMemo)(()=>(null==W?void 0:W.parentResponseId)?E[W.parentResponseId]:void 0,[W,E]),Y=(0,ei.useMemo)(()=>$?(0,ef.Vh)(t,$.imageEditUri):void 0,[$]),X=(0,ei.useMemo)(()=>{if(F){var e,n;return[{id:null!==(e=b.metadata.fileUri)&&void 0!==e?e:"",url:null!==(n=(0,ef.Vh)(t,b.metadata.fileUri))&&void 0!==n?n:"",isModerated:!1,progressMap:void 0}]}return B&&W?_&&W.streamingImageById?Object.entries(W.streamingImageById).map(e=>{var n;let[s,i]=e,a=Object.keys(i).map(Number),r=i[Math.max(...a)];return{id:s,url:null!==(n=(0,ef.Vh)(t,r.imageUrl))&&void 0!==n?n:"",isModerated:!1,progressMap:a.map(e=>{var n;return{progress:e/100,imageUrl:null!==(n=(0,ef.Vh)(t,i[e].imageUrl))&&void 0!==n?n:""}})}}):W.generatedImageUrls.map(e=>{var n,s,i;let a=null!==(s=Object.values(null!==(n=W.streamingImageById)&&void 0!==n?n:{})[0])&&void 0!==s?s:{},r=Object.keys(a).map(Number);return{id:e,url:null!==(i=(0,ef.Vh)(t,e))&&void 0!==i?i:"",isModerated:!1,progressMap:r.length>0?r.map(e=>{var n;return{progress:e/100,imageUrl:null!==(n=(0,ef.Vh)(t,a[e].imageUrl))&&void 0!==n?n:""}}):void 0}}):[]},[b,W,null==W?void 0:W.streamingImageById,B,_]),J=(0,ei.useMemo)(()=>X.length>1?X.find(e=>e.id===(null==b?void 0:b.key)||e.id===(null==b?void 0:b.assetKey)):X[0],[X,b]),Q=(0,ei.useMemo)(()=>(0,s.jsx)(eE,{isEditingCurrentImage:_,focusedImage:J,parentImageUrl:P?void 0:Y,isPeekingParent:Z,setIsPeekingParent:O,generatedImageWidth:null==W?void 0:W.generatedImageWidth,generatedImageHeight:null==W?void 0:W.generatedImageHeight,isParentImageLoaded:L,isFinalImageLoaded:G,setIsFinalImageLoaded:K,setIsParentImageLoaded:z}),[_,J,Z,Y,null==W?void 0:W.generatedImageWidth,null==W?void 0:W.generatedImageHeight,L,G,P]),et=(0,ei.useCallback)(e=>{e&&y(e)},[y]),es=(0,ei.useCallback)(e=>{let t=X[e];_&&y({key:t.id}),y({key:t.id,assetKey:t.id,url:t.url,isModerated:t.isModerated,progress:(null==t?void 0:t.progressMap)?Math.max(...Object.keys(t.progressMap).map(Number)):1})},[X,_]),ea=(0,ei.useCallback)(async()=>{let e=l.gK.getState(),t=ec.CI.getState();if(e.conversationId&&e.streamedMessageId)return U(!0),t.abortStream(e.conversationId,e.streamedMessageId).then(t=>{let n=l.gK.getState();n.conversationId===e.conversationId&&(n.setLastMessageId(t),n.setStreamedMessageId(t))}).catch(t=>{let n=l.gK.getState(),s=ey.i.getState();n.conversationId===e.conversationId&&((0,ex.xo)(t),e.setStreamedMessageId(void 0),s.close())}).finally(()=>{l.gK.getState().conversationId===e.conversationId&&(e.setUsingExperiment(!1),U(!1))})},[]),eo=(0,ei.useCallback)(async(e,t)=>{if(!e.trim()||!(null==b?void 0:b.url))throw Error("No message or image");let s=l.gK.getState(),i=eI.F.getState(),a=ec.CI.getState(),o=eb.O.getState(),d=t.replace(/^https?:\/\/[^/]+\/?/,"");k(""),o.removeByConversationId(s.conversationId||"no_conversation_id"),o.removeAttachByConversationId(s.conversationId||"no_conversation_id"),await r();let c=s.lastMessageId?a.byId[s.lastMessageId]:void 0;if(s.lastMessageId&&!c)throw Error("Last message is missing");if((null==c?void 0:c.sender)==="human")throw Error("Last message is human");"none"!==s.reasoningMode&&s.setReasoningMode("none");let u={message:e,toolOverrides:{imageGen:!0},imageEditUri:d,enableRetries:n.ENABLE_AUTO_STREAM_RETRY},p=F&&b.metadata.fileMetadataId&&!(null==$?void 0:$.message)?[b.metadata.fileMetadataId]:[];if(F)return s.conversationId?s.sendResponse({...u,parentResponseId:s.lastMessageId,conversationId:s.conversationId,fileAttachmentIds:p,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0}):s.establishNewConversation({...u,fileAttachmentIds:[b.metadata.fileMetadataId],temporary:i.isIncognito});if(!s.conversationId)throw Error("No conversation id");return s.sendResponse({...u,parentResponseId:s.lastMessageId,conversationId:s.conversationId,fileAttachmentIds:p,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0})},[b,r,F,$,i]),el=(0,ei.useCallback)(async(e,t)=>{let n=l.gK.getState(),s=ec.CI.getState(),i=n.streamedMessageId?s.byId[n.streamedMessageId]:void 0;return["streaming","optimistic","reconnecting"].includes((null==i?void 0:i.state)||"closed")&&await ea(),M(!0),eo(e,t).catch(()=>{ey.i.getState().close()})},[eo,ea]),ep=(0,ei.useCallback)(async(e,t)=>{if(e.trim()&&(null==J?void 0:J.url))return i.logEvent("edit_image_start",(0,eh.s)(J.url),{queryType:t?"preset":"manual",location:"image-editor",presetId:t||"",message:e,messageLength:String(e.length),timeToSendMs:String(m())}),el(e,J.url).catch(e=>{(0,ee.H)("image-viewer:ImageEditor:handleEditCurrentImage",e)})},[el,J,i,m]),ew=(0,ei.useCallback)(()=>{if((null==$?void 0:$.message)&&Y)return i.logEvent("edit_image_start",(0,eh.s)(Y),{queryType:"regenerate",location:"image-editor",presetId:"",message:null==$?void 0:$.message,messageLength:String(null==$?void 0:$.message),timeToSendMs:String(m())}),el($.message,Y).catch(e=>{(0,ee.H)("image-viewer:ImageEditor:handleRegenerate",e)})},[$,Y,el,i,m]);(0,ei.useEffect)(()=>{_&&X.length&&!X.find(e=>e.id===b.key)&&y({key:X[0].id})},[X,_,b]),(0,ei.useEffect)(()=>{let e=ey.i.getState();if(_&&w&&"error"===w.state)return e.close();if(_&&R&&w&&"closed"===w.state){var n,s,a,r;if(M(!1),T(null),!S)return e.close();let o=E[S];if(!o)return e.close();let l=null===(a=o.streamingImageById)||void 0===a?void 0:null===(s=a[null!==(r=null==b?void 0:b.key)&&void 0!==r?r:""])||void 0===s?void 0:null===(n=s[100])||void 0===n?void 0:n.imageUrl;if(!l)return e.close();i.logEvent("edit_image_end",(0,eh.s)((null==$?void 0:$.imageEditUri)||""),{location:"image-editor",streamingTimeMs:String(g())}),y({key:l,assetKey:l,url:(0,ef.Vh)(t,l),progress:100,isModerated:!1})}},[$,w,_,R,S,E,g]),(0,ei.useEffect)(()=>(h(),()=>h()),[h]),(0,ei.useEffect)(()=>{_||A?void 0===u&&p():void 0===c&&o()},[_,A,u,c,o,p]),(0,ei.useEffect)(()=>{if(null==J?void 0:J.url){K(!1);let e=new Image;e.onload=()=>K(!0),e.src=J.url}},[null==J?void 0:J.url]),(0,ei.useEffect)(()=>{if(Y){z(!1),D(!1);let e=new Image;e.onload=()=>z(!0),e.onerror=()=>D(!0),e.src=Y}},[Y]),(0,ei.useEffect)(()=>{v&&x&&(f(!1),eS.Am.message((0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-fg-primary font-bold",children:a("image-editor-welcome.title","Welcome to Image Editor")}),(0,s.jsx)("p",{className:"text-fg-secondary",children:a("image-editor-welcome.description","A focused space for you to transform images with Grok to anything you can imagine.")})]}),{duration:7e3}))},[v,x,f,a]);let eN=(0,ey.i)(eu.Z("close"));return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-between gap-6 sm:gap-20 w-full h-full",children:[(0,s.jsx)(er,{hasImage:H,prompt:Y?null==$?void 0:$.message:void 0,focusedImageUrl:null==J?void 0:J.url,parentImageUrl:P?void 0:Y,isStreaming:_||A,onParentPeek:e=>O(e),onClose:eN,onRegenerate:ew}),H?Q:x&&(0,s.jsx)(eA,{onUploadImage:et}),(0,s.jsx)("footer",{className:"relative w-full max-w-2xl h-16 flex-shrink-0 mt-12 sm:mt-0",children:(0,s.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex flex-col gap-4",children:[(0,s.jsx)(en.M,{mode:"popLayout",children:H&&X&&X.length>1&&(0,s.jsx)(ed,{isStreaming:_||A,images:X,focusedOption:X.findIndex(e=>e.id===(null==J?void 0:J.id))||0,onSelect:es})}),(0,s.jsx)(eM,{hasImage:H,isStreaming:_||A,onSend:ep}),(0,s.jsx)(em,{hasImage:H,inputValue:C,isStreaming:_||A,onInputValueChange:k,onSend:ep,onAbort:ea})]})})]})};var eL=n(40955),ez=n(6936),eP=n(35218);let eD=()=>{let{t:e}=(0,q.$G)("base"),t=(0,ey.i)(eu.Z("isOpen")),n=(0,ey.i)(eu.Z("close")),i=(0,l.gK)(eu.Z("conversationId")),[a,r]=(0,ei.useState)(void 0);return(0,ei.useEffect)(()=>{i!==a&&(a&&n(),r(i))},[i,n,a]),(0,s.jsx)(ez.Vq,{open:t,onOpenChange:e=>{e||n()},children:(0,s.jsxs)(eL.PK,{children:[(0,s.jsx)(ez.t9,{className:"fixed inset-0 z-50 bg-overlay duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),(0,s.jsxs)(ez.cZ,{"aria-describedby":e("Image editor","Image editor"),className:(0,el.cn)("fixed z-50 inset-0 bg-background duration-200 focus:outline-none","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 p-2 lg:p-6"),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},children:[(0,s.jsx)(eP.T,{children:(0,s.jsx)(eL.$N,{children:e("Image editor","Image editor")})}),(0,s.jsx)(eU,{})]})]})})};var eG=n(87005),eK=n(77119);let eH=e=>{let t=(0,ei.useRef)(null);return(0,ei.useEffect)(()=>{let n=n=>{t.current&&!t.current.contains(n.target)&&e()};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[e]),t};var eB=n(13771),eF=n(46293),eW=n(61726),e$=n(33931),eq=n(36312),eV=n(33263),eY=n(44199),eX=n(36270),eJ=n(38199);let eQ=(0,ei.forwardRef)((e,t)=>{let{onSelect:n,conversation:i,onRemove:a,isEditing:r,newTitle:o,onNewTitleChange:l,onEditStart:d,onEditSave:c,onEditCancel:m,isActive:g=!1,isDragging:h=!1,isStreaming:v=!1,isLoading:f=!1,isReconnecting:x=!1,showActions:b,className:y,...I}=e,{t:j}=(0,q.$G)("base"),S=(0,ei.useCallback)(e=>{"keydown"===e.type&&"Enter"!==e.key||h||(e.preventDefault(),n(i.conversationId))},[i.conversationId,n,h]),w=(0,ei.useCallback)(e=>{e.stopPropagation(),a(i.conversationId)},[i.conversationId,a]),E=(0,ei.useCallback)(e=>{e.stopPropagation(),("click"===e.type||e instanceof KeyboardEvent&&"Enter"===e.key)&&d(i.conversationId)},[d,r,i.conversationId]),N=(0,ei.useCallback)(e=>{e.stopPropagation(),("click"===e.type||e instanceof KeyboardEvent&&"Enter"===e.key)&&c(i.conversationId)},[c,o,i.conversationId]),C=(0,ei.useCallback)(e=>{l(e.target.value)},[o]),k=(0,ei.useCallback)(e=>{e.stopPropagation(),"Enter"===e.key?c(i.conversationId):"Escape"===e.key&&m()},[N,m]),_=(0,ei.useMemo)(()=>{if(i.temporary)return j("Temporary Chat","Temporary Chat");if(i.title)return i.title;if(i.createTime){let e=new Date(i.createTime);return"".concat(j("Chat on","Chat on")," ").concat(e.toLocaleDateString())}return j("Untitled Chat","Untitled Chat")},[j,i]);return f?(0,s.jsx)(eJ.O,{className:"w-full h-8 my-1 rounded-xl"}):(0,s.jsxs)("div",{...I,ref:t,className:(0,el.cn)("group px-2 py-1 text-sm hover:bg-button-ghost-hover w-full min-h-10 flex items-center rounded-2xl border gap-1.5","focus:outline-none focus-visible:ring-1 ring-ring ring-inset",g?"bg-button-ghost-hover text-fg-primary border-border-l1":"text-fg-secondary border-transparent",y),onClick:S,onKeyDown:S,tabIndex:0,role:"button",children:[r?(0,s.jsx)("input",{className:"w-full bg-transparent focus-visible:outline-none",value:o,onKeyDown:k,onChange:C,autoFocus:!0}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e0,{isStreaming:v,isReconnecting:x,conversation:i}),(0,s.jsx)("span",{className:"flex-1 select-none text-nowrap max-w-full overflow-hidden inline-block",style:{maskImage:"linear-gradient(to right, black 85%, transparent 100%)",WebkitMaskImage:"linear-gradient(to right, black 85%, transparent 100%)"},children:_})]}),r?(0,s.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,s.jsx)(p.g$,{variant:"ghost",size:"iconSm",className:"p-2",onClick:e=>{e.stopPropagation(),m()},tooltipContent:j("Cancel","Cancel"),tooltipContentProps:{hideWhenDetached:!0},children:(0,s.jsx)(u.b0,{size:16,className:"text-fg-primary"})}),(0,s.jsx)(p.g$,{variant:"ghost",size:"iconSm",className:"p-2",onClick:N,tooltipContent:j("Save","Save"),tooltipContentProps:{hideWhenDetached:!0},children:(0,s.jsx)(eY.Z,{size:16,className:"text-fg-primary"})})]}):(0,s.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[!i.temporary&&!h&&(0,s.jsx)(p.g$,{tabIndex:-1,className:(0,el.cn)("hidden group-hover:flex group-focus-visible:flex text-fg-secondary",b&&"flex"),onClick:E,variant:"ghost",size:"iconSm",tooltipContent:j("Rename","Rename"),tooltipContentProps:{hideWhenDetached:!0},children:(0,s.jsx)(u.Mw,{})}),!h&&(0,s.jsx)(p.g$,{className:(0,el.cn)("hidden group-hover:flex group-focus-visible:flex text-fg-secondary",b&&"flex"),onClick:w,variant:"ghost",size:"iconSm",tooltipContent:j("Close","Close"),tooltipContentProps:{hideWhenDetached:!0},children:(0,s.jsx)(u.b0,{})})]})]})}),e0=e=>{let{conversation:t}=e,{personaById:n}=(0,eV.HG)(),i=(0,ei.useMemo)(()=>{if(!(0,eV.VO)(t.personaId))return;let e=n[t.personaId];if(e)return{...e,...(0,eX.DB)(e.personaId)}},[t.personaId,n]);return t.temporary?(0,s.jsx)(u.L_,{className:"h-4 w-4"}):i&&(0,s.jsx)("span",{className:(0,el.cn)("[&>svg]:h-4 [&>svg]:w-4",i.colorClassName),children:i.icon})};var e1=n(45776);function e2(e){let{id:t,element:n,children:i,options:a,isDragging:r,disabled:o=!1}=e,{attributes:l,listeners:d,setNodeRef:c,transform:u,transition:p}=(0,e$.nB)({id:t,transition:{duration:150,easing:"cubic-bezier(0.25, 1, 0.5, 1)"},disabled:o,...a}),m={transform:e1.ux.Transform.toString(u),transition:p,opacity:r?0:1};return(0,s.jsx)(n||"div",{ref:c,...d,...l,style:m,children:i})}var e4=n(63064);let e3=()=>{let{routeToConversation:e}=(0,eK.o)(),{client:t}=(0,ej.useStatsigClient)(),n=(0,eB.t)(eu.Z("byId")),i=(0,eB.t)(eu.Z("fetchUpdateConversation")),a=(0,e4.N)(eu.Z("drawerOpen")),r=(0,e4.N)(eu.Z("setDrawerOpen")),o=(0,e4.N)(eu.Z("menuFixed")),d=(0,e4.N)(eu.Z("toggleMenuFixed")),c=(0,e4.N)(eu.Z("menuHidden")),m=(0,e4.N)(eu.Z("setMenuHidden")),g=(0,e4.N)(eu.Z("tabsCount")),h=(0,e4.N)(eu.Z("activeTabs")),v=(0,e4.N)(eu.Z("activeTempTabs")),f=(0,e4.N)(eu.Z("setActiveTabs")),x=(0,e4.N)(eu.Z("setActiveTempTabs")),b=(0,e4.N)(eu.Z("addAnyTab")),y=(0,e4.N)(eu.Z("removeActiveTab")),I=(0,e4.N)(eu.Z("removeActiveTempTab")),j=(0,e4.N)(eu.Z("inEditId")),S=(0,e4.N)(eu.Z("setInEditId")),w=(0,l.gK)(eu.Z("conversationId")),E=(0,eB.t)(eu.Z("fetchGetManyConversations")),[N,C]=(0,ei.useState)(),[k,_]=(0,ei.useState)(""),[M,R]=(0,ei.useState)(!1),[T,Z]=(0,ei.useState)(!1),[O,A]=(0,ei.useState)(!1),U=(0,J.r)(),{t:L}=(0,q.$G)("base"),z=(0,ei.useCallback)(e=>{var t;return(null===(t=n[e])||void 0===t?void 0:t.temporary)||!1},[n]),P=(0,ei.useMemo)(()=>Object.entries({...h,...v}).map(e=>{let[t,n]=e;return{conversationId:t,index:n.index}}).sort((e,t)=>e.index-t.index),[h,v]),D=(0,ei.useMemo)(()=>P.map(e=>({...n[e.conversationId],conversationId:e.conversationId})).filter(e=>!!e.conversationId),[n,P]);(0,ei.useEffect)(()=>{if(w&&!h[w]&&!v[w]){var e,t;let s=null!==(t=null===(e=n[w])||void 0===e?void 0:e.temporary)&&void 0!==t&&t;b(w,s)}},[w,h,v,n,b]);let G=(0,ei.useCallback)(n=>{if(n===j)return;W(),r(!1);let s=z(n);e(n,s),t.logEvent("select_conversation",n,{location:"tabs-manager"})},[j,e,z]);(0,ei.useEffect)(()=>{let e=Object.keys(h).concat(Object.keys(v)).filter(e=>!n[e]);0===e.length||O||(Z(!0),A(!0),E(e).finally(()=>{Z(!1)}))},[h,v,n,E,O]);let K=(0,ei.useCallback)(n=>{if(n===w){var s;e(null===(s=D.filter(e=>e.conversationId!==n)[0])||void 0===s?void 0:s.conversationId)}z(n)?I(n):y(n),t.logEvent("close_tab",n,{location:"tabs-manager"})},[w,D,y,I,e,z]),H=(0,ei.useCallback)(e=>{let t=D.find(t=>t.conversationId===e);S(e),_((null==t?void 0:t.title)||"")},[D]),B=(0,ei.useCallback)(async e=>{if(j!==e)return;let n=k.trim();if(""===n)return;let s=D.find(t=>t.conversationId===e);if(s)try{await i(e,{title:n,starred:s.starred}),S(void 0),t.logEvent("update_conversation",e,{location:"tabs-manager"})}catch(e){(0,ex.xo)(e)}},[j,k,D,i]),F=eH(()=>{j&&W()}),W=(0,ei.useCallback)(()=>{S(void 0),_("")},[S,_]),$=(0,eF.VT)(eF.MA,{activationConstraint:{distance:8}}),V=(0,eF.Dy)($),Y=(0,ei.useCallback)(e=>{C(e.active.id),S(void 0)},[C,S]),X=(0,ei.useCallback)(e=>{let{active:n,over:s}=e,i=null==n?void 0:n.id,a=null==s?void 0:s.id;if(i&&a&&i!==a){let e=P.findIndex(e=>e.conversationId===i),t=P.findIndex(e=>e.conversationId===a);if(-1!==e&&-1!==t){let n=(0,e$.Rp)(P,e,t).map((e,t)=>({...e,index:t})),s=Object.fromEntries(n.filter(e=>!z(e.conversationId)).map(e=>[e.conversationId,{index:e.index}])),i=Object.fromEntries(n.filter(e=>z(e.conversationId)).map(e=>[e.conversationId,{index:e.index}]));f(s),x(i)}}C(void 0),t.logEvent("reorder_tab")},[P,f,x,z]),Q=(0,ei.useCallback)(()=>{C(void 0)},[]),ee=(0,ei.useCallback)(()=>{d(),m(!o)},[d,o,m,c]),et=(0,ei.useCallback)(e=>{e.clientX>24&&m(!0),S(void 0)},[m,c]),en=(0,ei.useCallback)(e=>{e.clientX<64&&m(!1)},[m,c]),ea=(0,ei.useCallback)(()=>{r(!1)},[r]),er=(0,ei.useCallback)(()=>{let n=Object.fromEntries(D.filter(e=>e.conversationId===w).map((e,t)=>[e.conversationId,{index:t}]));f(n),x({}),D.length>0&&0===Object.keys(n).length&&e(void 0),R(!1),r(!1),t.logEvent("clear_all_tabs")},[D,w,f,x,e]),eo=(0,ei.useMemo)(()=>D.find(e=>e.conversationId===N),[D,N]),ed=(0,ei.useMemo)(()=>P.map(e=>e.conversationId),[P]);return U&&g>0?(0,s.jsx)(ek.dy,{open:a,onClose:ea,dismissible:!0,children:(0,s.jsxs)(ek.sc,{className:"bg-surface-base px-2 max-h-[90vh] focus:outline-none",children:[(0,s.jsxs)(ek.OX,{className:"px-2 w-full pb-0 flex items-center h-8 gap-1",children:[(0,s.jsx)(ek.iI,{className:"text-primary flex-1 whitespace-nowrap text-sm font-medium truncate text-left",children:L("active-tabs.label",{count:g,defaultValue_one:"Tab",defaultValue_other:"Tabs"})}),(0,s.jsx)("div",{className:"h-5 min-w-5 p-1 bg-surface-l1 text-xs flex items-center justify-center border border-border-l2 rounded-lg mr-1.5",children:g}),g>1&&(0,s.jsx)(p.zx,{className:(0,el.cn)("text-fg-secondary h-6 inline-block w-fit transition-[max-width] duration-200 ease-in-out overflow-hidden px-2",M?"opacity-100 max-w-full":"opacity-70 hover:opacity-100 max-w-6"),onClick:er,variant:"ghost",size:"iconSm",children:(0,s.jsx)(es.E.span,{variants:e5,initial:"initial",animate:"animate",exit:"exit",transition:{duration:.2},className:"flex items-center justify-center whitespace-nowrap",children:M?(0,s.jsx)("span",{className:"text-xs font-medium",children:L("clear-tabs-button.label","Clear")}):(0,s.jsx)(u.b0,{className:"w-4 h-4"})},M?"clear":"xicon")})]}),(0,s.jsx)("div",{className:"flex flex-col z-10 h-full w-full gap-1 py-4 min-h-[50dvh] overflow-y-auto [mask-image:linear-gradient(to_bottom,transparent_0%,black_16px,black_calc(100%-16px),transparent_100%)] [-webkit-mask-image:linear-gradient(to_bottom,transparent_0%,black_16px,black_calc(100%-16px),transparent_100%)]",children:D.map(e=>(0,s.jsx)(eQ,{showActions:!0,className:"py-3 rounded-xl",isLoading:T&&!n[e.conversationId],isEditing:j===e.conversationId,newTitle:k,onNewTitleChange:_,onEditStart:H,onRemove:K,onEditSave:B,onEditCancel:W,conversation:e,onSelect:G,isActive:w===e.conversationId,isDragging:e.conversationId===N},e.conversationId))})]})}):!U&&g>0?(0,s.jsxs)("div",{ref:F,className:(0,el.cn)("group/menu mx-3 flex flex-col absolute top-16 left-0 max-h-[calc(100dvh-80px)] h-full px-2 py-1 pb-2","border border-border-l1","w-52 @[1440px]/mainview:w-64","bg-surface-l3 shadow-md rounded-3xl","transition-all duration-200 ease-in-out",c?"-translate-x-[220px] @[1440px]/mainview:-translate-x-[268px] px-2 pb-2 ":"translate-x-0 ",o&&"@7xl/mainview:!translate-x-0 @7xl/mainview:shadow-none @7xl/mainview:bg-surface-base @7xl/mainview:border-0 @7xl/mainview:p-0"),onMouseEnter:en,onMouseLeave:et,children:[(0,s.jsx)("div",{onMouseEnter:en,className:"h-full absolute -right-6 w-6 @4xl/mainview:-right-9 @4xl/mainview:w-9"}),(0,s.jsxs)(eF.LB,{sensors:V,collisionDetection:eF.pE,onDragStart:Y,onDragEnd:X,onDragCancel:Q,modifiers:[eW.F4],children:[(0,s.jsx)(e$.Fo,{items:ed,strategy:e$.qw,children:(0,s.jsx)("div",{className:"flex flex-col gap-1 h-full overflow-y-auto py-1 [mask-image:linear-gradient(to_bottom,transparent_0%,black_4px,black_calc(100%-4px),transparent_100%)] [-webkit-mask-image:linear-gradient(to_bottom,transparent_0%,black_4px,black_calc(100%-4px),transparent_100%)]",children:D.map(e=>(0,s.jsx)(e2,{disabled:j===e.conversationId,id:e.conversationId,isDragging:e.conversationId===N,children:(0,s.jsx)(eQ,{isEditing:j===e.conversationId,isLoading:T&&!n[e.conversationId],newTitle:k,onNewTitleChange:_,onEditStart:H,onRemove:K,onEditSave:B,onEditCancel:W,conversation:e,onSelect:G,isActive:w===e.conversationId,isDragging:e.conversationId===N})},e.conversationId))})}),(0,s.jsx)(eF.y9,{children:eo?(0,s.jsx)(e=>{let{conversation:t,isMobile:n}=e;return(0,s.jsx)(eQ,{onRemove:K,isEditing:j===t.conversationId,newTitle:k,onNewTitleChange:_,onEditStart:H,onEditSave:B,onEditCancel:W,conversation:t,onSelect:G,isActive:w===t.conversationId,isDragging:!0,showActions:n,className:(0,el.cn)(n?"py-3 rounded-xl":"","!bg-surface-l3 !text-fg-primary shadow-sm !opacity-100 absolute -translate-y-16 cursor-move z-[100]")},t.conversationId)},{conversation:eo,isMobile:!1}):null})]}),(0,s.jsxs)("div",{className:" flex items-center group w-full justify-between py-1 h-8 rounded-xl transition-colors focus:outline-none focus-visible:ring-1 ring-ring ring-inset max-w-full",children:[(0,s.jsx)(p.zx,{onClick:er,variant:"ghost",size:"sm",className:"rounded-full text-fg-secondary px-2 h-9 opacity-50 group-hover/menu:opacity-100 transition-opacity",children:(0,s.jsx)("span",{className:"text-xs font-medium",children:L("clear-tabs-button.label","Clear")})}),(0,s.jsx)(p.zx,{onClick:ee,variant:"ghost",size:"iconMd","aria-label":o?L("toggle-tabs-visibility.close","Hide tabs"):L("toggle-tabs-visibility.lock","Lock tabs"),className:(0,el.cn)("hidden @4xl/mainview:flex w-9 h-9 opacity-50 group-hover/menu:opacity-100 transition-opacity"),children:(0,s.jsx)(eq.Z,{className:(0,el.cn)("h-4 w-4 transition-transform text-fg-secondary",o?"rotate-0":"rotate-180")})})]})]}):null},e5={initial:{opacity:0,translateX:-1},animate:{opacity:1,translateX:0},exit:{opacity:0,translateX:-1}};var e6=n(28147),e8=n(69195),e7=n(4077),e9=n(89099),te=n(20592),tt=n(40794);let tn=e=>{switch(e){case"GOOGLE_DRIVE":return"Google Drive";case"MICROSOFT_ONEDRIVE":return"Microsoft One Drive";default:return"provider"}};var ts=n(38453),ti=n(65671),ta=n(14075),tr=n(15419),to=n(48186),tl=n(41860),td=n(57513),tc=n(55911),tu=n(48038),tp=n(30722),tm=n.n(tp),tg=n(41916),th=n(11908),tv=n(90047),tf=n(51892),tx=n(62081),tb=n(9682),ty=n(83716),tI=n(26777),tj=n(27422);function tS(){let e=(0,ei.useRef)(void 0),t=(0,ei.useRef)(0),n=(0,ei.useRef)([]),s=(0,ei.useRef)(void 0),i=(0,ei.useRef)(0),[a,r]=(0,ei.useState)(void 0),[o,l]=(0,ei.useState)(0),[d,c]=(0,ei.useState)(0),u=(0,ei.useCallback)(a=>{if(void 0==e.current&&(e.current=Date.now()),"Backspace"===a.key&&t.current++,s.current){let e=Date.now()-s.current;n.current.push(e)}s.current=Date.now(),i.current++},[]),p=(0,ei.useCallback)(()=>{let t=(0,tj.Z)(e.current);return e.current=void 0,t},[]),m=(0,ei.useCallback)(()=>{let e=t.current;return t.current=0,e},[]),g=(0,ei.useCallback)(()=>{let e=i.current;return i.current=0,e},[]),h=(0,ei.useCallback)(()=>{let e=n.current;return n.current=[],tm().mean(e)},[]),v=(0,ei.useCallback)(()=>(r(void 0),a),[a]),f=(0,ei.useCallback)(()=>{e.current=void 0,t.current=0,n.current=[]},[]);return{handleKeyDown:u,consumeCompositionTimeMs:p,consumeBackspaceCount:m,consumeAvgKeystrokeLatency:h,consumeKeystrokeCount:g,position:a,setPosition:r,consumePosition:v,reset:f,consumeTypeaheadReqCount:(0,ei.useCallback)(()=>(l(0),o),[o]),incrementTypeaheadReqCount:()=>{l(e=>e+1)},consumeSuggestionsShownCount:(0,ei.useCallback)(()=>(c(0),d),[d]),incrementSuggestionsShownCount:(0,ei.useCallback)(()=>{c(e=>e+1)},[])}}function tw(e){let{onSubmit:t,isIncognito:n,disabled:i}=e,{t:a}=(0,q.$G)("chat"),{client:r}=(0,ej.useStatsigClient)(),o=(0,V.g)(),{user:d}=(0,tI.kP)(),c=(0,l.gK)(eu.Z("activeModelId")),p=(0,l.gK)(eu.Z("reasoningMode")),m=(0,e7.Md)(),{signInWithReturnTo:g}=(0,eK.o)(),h=(0,eg.X)(),v=(0,l.gK)(eu.Z("conversationId")),f=(0,eB.t)(e=>v?e.byId[v]:void 0),x=(0,l.gK)(eu.Z("lastMessageId")),b=(0,l.gK)(eu.Z("streamedMessageId")),y=(0,ec.CI)(eu.Z("byId")),I=(0,eb.O)(eu.Z("listByConversationId")),j=(0,eb.O)(eu.Z("attachListByConversationId")),S=v&&I[v]||[],w=v&&j[v]||[],E=(0,ei.useMemo)(()=>!n&&o.SHOW_IMAGE_EDIT&&(S.length>0&&!!S.every(e=>e.file.type.includes("image"))||(null==w?void 0:w.length)>0&&!!w.every(e=>e.mimeType.includes("image"))),[S,w,o.SHOW_IMAGE_EDIT,n]),N=(0,ei.useCallback)(async()=>{let e=l.gK.getState(),t=ec.CI.getState();if(e.conversationId&&e.streamedMessageId)return t.abortStream(e.conversationId,e.streamedMessageId).then(t=>{let n=l.gK.getState();n.conversationId===e.conversationId&&(n.setLastMessageId(t),n.setStreamedMessageId(t))}).catch(t=>{l.gK.getState().conversationId===e.conversationId&&((0,ex.xo)(t),e.setStreamedMessageId(void 0))}).finally(()=>{l.gK.getState().conversationId===e.conversationId&&e.setUsingExperiment(!1)})},[]),C=(0,ei.useMemo)(()=>x?y[x]:void 0,[x,y]),k=(0,ei.useMemo)(()=>{let e=b?y[b]:void 0;if((null==e?void 0:e.parentResponseId)===x)return e},[b,y,x]),_=(0,ei.useCallback)(()=>{let e=ec.CI.getState();C&&C.suggestions&&C.suggestions.length>0&&e.upsertResponse({...C,suggestions:[]})},[C]),{getPersonaForConversation:M}=(0,eV.HG)(),R=M(f),{handleKeyDown:T,consumeCompositionTimeMs:Z,consumeBackspaceCount:O,consumeAvgKeystrokeLatency:A,reset:U}=tS();(0,ei.useEffect)(()=>{U()},[v]);let L=(0,ei.useCallback)(async(e,s,i,a)=>{if(null==t||t(),!e||!e.trim())return!1;let u=l.gK.getState(),v=ec.CI.getState();if(!d&&(!o.ENABLE_ANON_USERS||m.includes(c)))return r.logEvent("sign_in","chat-new",{location:"chat-new"}),g(e,p),!1;if(!u.conversationId)return await u.establishNewConversation({message:e,fileAttachmentIds:s,webpageUrls:i,toolOverrides:a,temporary:n,enableRetries:o.ENABLE_AUTO_STREAM_RETRY}).catch(e=>{(0,ee.H)("chat-input:establishNewConversation",e)}),!0;await h(),_();let f=u.lastMessageId?v.byId[u.lastMessageId]:void 0;if(u.lastMessageId&&!f)return(0,ee.H)("chat-input:ChatInput:handleSend:lastMessage","Last message is missing"),!1;if(f&&"human"===f.sender)return(0,ee.H)("chat-input:ChatInput:handleSend:lastMessage","Last message is human"),!1;let x=eI.F.getState();return r.logEvent("send_query",e,{parentResponseId:u.lastMessageId||"",conversationId:u.conversationId,selectedModel:u.activeModelId,fileAttachments:String((null==s?void 0:s.length)||0),webpageUrls:String((null==i?void 0:i.length)||0),location:"chat-input",outputMode:u.outputMode,reasoningMode:u.reasoningMode,personalityId:x.userSettings.preferences.selectedSystemPromptId||"",personaId:(null==R?void 0:R.personaId)||"",messageLength:String(e.length),compositionTime:String(Z()),backspaceCount:String(O()),avgKeystrokeLatency:String(A())}),new Promise((t,n)=>{if(!u.conversationId)return(0,ee.H)("chat-input:ChatInput:handleSend:promise","No conversation found"),!1;u.sendResponse({message:e,parentResponseId:u.lastMessageId,conversationId:u.conversationId,fileAttachmentIds:s||[],webpageUrls:i||[],toolOverrides:a,setOpimisticUserResponse:!0,setUserResponse:!0,persona:R,enableRetries:o.ENABLE_AUTO_STREAM_RETRY,onOptimisticUserResponse:()=>t(!0),onError:n}).catch(n)})},[R,_,t,r,p,o.ENABLE_AUTO_STREAM_RETRY]),z=(0,ei.useCallback)(e=>{r.logEvent("clicked_follow_up",e.label,{parentResponseId:x||"",conversationId:v||""}),L(e.label,void 0,void 0,e.toolOverrides?e.toolOverrides:void 0).catch(e=>{(0,ee.H)("chat-input:ChatInput:suggestion:handleSend",e)})},[L,r,x,v]),P=(0,ei.useCallback)(()=>{r.logEvent("clicked_clear_follow_ups",void 0,{parentResponseId:x||"",conversationId:v||""}),_()},[_,r,x,v]);return(0,s.jsxs)("div",{className:"relative z-40 flex flex-col items-center w-full",children:[(0,s.jsxs)(en.M,{mode:"popLayout",initial:!1,children:[!E&&(0,s.jsx)(es.E.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,s.jsx)(tE,{lastMessage:C,onClickFollowUp:z,onClickClearFollowUps:P})},"follow-ups"),E&&(0,s.jsx)(es.E.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"mb-2 bg-background rounded-full",children:(0,s.jsxs)(tb.d,{conversationId:v,shouldGetFromStore:!0,buttonProps:{variant:"card",size:"pill"},location:"chat-input",className:"py-3 px-4 h-auto",children:[(0,s.jsx)(u.NP,{className:"size-5 text-secondary"}),a("Edit Image","Edit Image")]})},"edit")]}),(0,s.jsxs)("div",{className:"relative w-full sm:px-5 px-2 pb-2 sm:pb-4",children:[(0,s.jsx)(ty.B,{placeholder:a("How can Grok help?","How can Grok help?"),onQuery:L,streamState:(null==k?void 0:k.state)||"closed",onAbort:N,isIncognito:n,disabled:i,onKeyDown:T},"query-bar"),(0,s.jsx)("div",{className:"absolute bottom-0 w-[calc(100%-2rem)] h-full rounded-t-[40px] bg-background"})]})]})}function tE(e){let{lastMessage:t,onClickFollowUp:n,onClickClearFollowUps:i}=e,a=(0,V.g)(),r=(0,eI.F)(e=>e.userSettings.preferences.showFollowUpSuggestions);return a.SHOW_FOLLOWUPS&&r&&t&&t.hasImages&&t.suggestions&&t.suggestions.length>0?(0,s.jsxs)("div",{className:(0,el.cn)("w-full flex justify-start sm:justify-center gap-2 pb-3 overflow-x-auto",to.c,"no-scrollbar absolute inset-x-0 bottom-full"),children:[t.suggestions.map((e,t)=>(0,s.jsx)("button",{className:(0,el.cn)("rounded-full px-4 py-1 whitespace-nowrap bg-input backdrop-blur-lg ring-1 ring-input-border ring-inset","focus-within:ring-input-border-focus focus-within:bg-input-hover","hover:ring-input-border-focus hover:bg-input-hover"),onClick:()=>n(e),children:e.label},t)),(0,s.jsx)("button",{className:(0,el.cn)("rounded-full px-2 py-1","bg-input backdrop-blur-lg","ring-1 ring-input-border ring-inset","focus-within:ring-input-border-focus focus-within:bg-input-hover","hover:ring-input-border-focus hover:bg-input-hover"),onClick:i,children:(0,s.jsx)(tg.Z,{className:"!size-4"})})]}):null}var tN=n(46850);function tC(){let{t:e}=(0,q.$G)("chat");return(0,s.jsx)("div",{className:"flex flex-col items-center justify-center min-h-dvh",children:(0,s.jsx)(tN._,{title:e("Link not shared correctly","Link not shared correctly"),description:e("If this was a link someone shared with you, please ask the sender to explicitly share the conversation.","If this was a link someone shared with you, please ask the sender to explicitly share the conversation."),cta:e("Return to home","Return to home")})})}var tk=n(50121),t_=n(42032),tM=n(82112),tR=n(725);function tT(e){let{optimisticResponse:t,isIncognito:n}=e,{sender:i}=t,a="human"===i;return(0,s.jsxs)(tM.V,{isUser:a,children:[(0,s.jsx)(t_.Y,{isUser:a,isIncognito:n,children:(0,s.jsx)(tR.i,{response:t,isStreaming:!1})}),(0,s.jsx)("div",{className:"h-10"})]})}var tZ=n(34415);let tO={state:"optimistic"};function tA(e){let{streamingResponses:t,usingExperiment:n,onRetry:i}=e,{client:a}=(0,ej.useStatsigClient)(),{t:r}=(0,q.$G)("chat"),o=(0,l.gK)(eu.Z("isRateLimited")),d=(0,l.gK)(eu.Z("isUnauthenticated")),c=tm().first(t)||tO,u=(0,ei.useRef)(t);u.current=t;let{sender:p}=c,m="human"===p,g=(0,ei.useMemo)(()=>{let e=Object.keys((null==c?void 0:c.streamingImageById)||{}).map(e=>{var t;return null==c?void 0:null===(t=c.streamingImageById)||void 0===t?void 0:t[e]});return"error"===c.state&&((null==e?void 0:e.some(e=>!(null==e?void 0:e[100])))||e.length<(c.imageAttachmentCount||0))},[null==c?void 0:c.streamingImageById,null==c?void 0:c.state,null==c?void 0:c.imageAttachmentCount]),h=(0,ei.useCallback)(e=>{let t=u.current,n=t[e],s=t[0==e?1:0];if(!n||!s||!s.responseId||!n.responseId||!n.conversationId){(0,ee.H)("streaming-response:StreamingResponse:handleClickPrefer","Missing preferredResponse or nonPreferredResponse or their data,"+"preferredResponse: ".concat(JSON.stringify(tm().pick(n,["conversationId","responseId","parentResponseId"])))+"nonPreferredResponse: ".concat(JSON.stringify(tm().pick(s,["conversationId","responseId","parentResponseId"]))));return}a.logEvent("user_side_by_side_preference",n.responseId,{index:e.toString(),nonPreferredResponseId:s.responseId,conversationId:n.conversationId});let i=l.gK.getState();i.setLastMessageId(n.parentResponseId),i.setStreamedMessageId(n.responseId),i.setUsingExperiment(!1)},[a]),v=t.some(e=>"streaming"===e.state||"reconnecting"===e.state);return n?(0,s.jsx)(tZ.C,{children:t.map((e,t)=>(0,s.jsx)(tZ.L,{index:t,response:e,isStreaming:v,onClickPrefer:h},t))}):(0,s.jsxs)(tM.V,{isUser:m,children:[(0,s.jsx)(t_.Y,{isUser:m,children:(0,s.jsx)(tR.i,{response:c,isStreaming:v,isModerated:g})}),d&&(0,s.jsx)("div",{className:"flex -ml-5 mt-2",children:(0,s.jsx)(tk.i,{title:r("Unauthenticated.errorMessage","Unable to confirm user authenticity."),description:r("Unauthenticated.description","Please log in or refresh the page")})}),!d&&!o&&!g&&"error"===c.state&&(0,s.jsx)("div",{className:"flex -ml-5 mt-2",children:(0,s.jsx)(tk.i,{title:r("Grok was unable to finish replying.errorMessage","Grok was unable to finish replying."),description:r("Grok was unable to finish replying.description","Please try again later or use a different model."),onRetry:i})})]})}let tU=[];function tL(e){let{optimisticUserResponse:t}=e,n=(0,ec.CI)(eu.Z("byConversationId")),i=(0,ei.useMemo)(()=>t?n[t.conversationId].filter(e=>e.parentResponseId===t.responseId):tU,[n,t]);return(0,s.jsx)(tA,{streamingResponses:i,usingExperiment:!1})}var tz=n(48737);function tP(e){let{conversationId:t,conversation:n,isOptimisticConversation:i,conversationError:o,isReconnecting:d}=e,{t:c}=(0,q.$G)("chat"),{client:m}=(0,ej.useStatsigClient)(),g=(0,ta.useRouter)(),[h,{height:v}]=(0,tx.Z)(),[f,x]=(0,ei.useState)(0),[b,y]=(0,ei.useState)(""),I=(0,V.g)(),j=(0,l.gK)(eu.Z("lastMessageId")),S=(0,ec.CI)(eu.Z("loadInitialResponses")),w=(0,ec.CI)(eu.Z("loadMoreResponses")),E=(0,ec.CI)(eu.Z("loadConversationBranch")),N=(0,ec.CI)(eu.Z("nodesByConversationId")),C=(0,ec.CI)(eu.Z("byConversationId")),k=(0,l.gK)(eu.Z("isRateLimited")),_=(0,eI.F)(eu.Z("isIncognito")),M=(0,eI.F)(e=>e.userSettings.preferences.disableAutoScroll),{user:R}=(0,eG.useSession)(),{data:T}=(0,tc.Pd)(),Z=I.HIDE_SUBSCRIPTION_FLOWS_FROM_PREMIUM_PLUS_USERS&&(null==R?void 0:R.xSubscriptionType)==="PremiumPlus"||(null==T?void 0:T.hasSubscriptions),O=(0,ei.useRef)(null),{getPersonaForConversation:A}=(0,eV.HG)(),U=A(n),L=(0,l.gK)(eu.Z("hasDismissedDisclaimer")),z=(0,l.gK)(eu.Z("setHasDismissedDisclaimer")),P=(0,l.gK)(eu.Z("reconnectToInflightResponses")),D=i?_:n?!!R&&n.temporary:_,G=(0,l.gK)(eu.Z("streamedMessageId")),K=(0,l.gK)(eu.Z("setStreamedMessageId")),H=(0,ec.CI)(eu.Z("byId")),B=(0,l.gK)(eu.Z("streamingExperimentsIds")),F=(0,l.gK)(eu.Z("usingExperiment")),W=(0,l.gK)(eu.Z("removeAllStreamingExperiments")),$=(0,l.gK)(eu.Z("experiments")),[Y,X]=(0,ei.useState)(!1),Q=(0,ei.useMemo)(()=>{if(F)return B.map(e=>H[e]).filter(e=>e&&(e.parentResponseId===j||e.responseId===j)&&e.conversationId===t);if(G){let e=H[G];if(e&&(e.parentResponseId===j||e.responseId===j)&&e.conversationId===t)return[e]}return[]},[F,B,G,H,j,t]),et=(0,l.gK)(eu.Z("optimisticMessageId")),er=(0,l.gK)(eu.Z("setOptimisticMessageId")),eo=et?H[et]:void 0,ed=(0,ei.useMemo)(()=>(null==n?void 0:n.conversationId)?S(n.conversationId):void 0,[null==n?void 0:n.conversationId,S]),{data:ep,isLoading:em,error:eg}=(0,e9.f)(ed),eh=(0,ei.useMemo)(()=>{let e=C[t];return null==e?void 0:e.filter(e=>!e.responseId.startsWith("streaming_in_progress")&&(!e.state||"closed"===e.state))},[C,t]),[ev,ef]=(0,ei.useState)(!1),[eb,ey]=(0,ei.useState)(!1),eS=(0,ei.useMemo)(()=>(0,te.$P)(C[t]||[],N[t]||[],j),[t,N,C,j]);(0,ei.useEffect)(()=>{ey(!0),setTimeout(()=>{ey(!1)},1e3)},[t]);let ew=(0,ei.useCallback)(()=>{var e;if(!t||!j||eb)return;let n=null===(e=eB.current)||void 0===e?void 0:e.el,s=(null==n?void 0:n.scrollHeight)||0,i=(null==n?void 0:n.scrollTop)||0;ef(!0),ey(!0),w(t,j).then(()=>{requestAnimationFrame(()=>{if(n){let e=n.scrollHeight;n.scrollTop=i+(e-s)}}),setTimeout(()=>{ey(!1)},100)}).catch(e=>{(0,ex.xo)(e),ey(!1)}).finally(()=>{ef(!1)})},[t,w,j,eb]),eE=(0,ei.useRef)(null),eN=(0,ei.useRef)(null),eC=(0,th.Y)(eE,{root:eN,margin:"0px 0px 300px 0px"});(0,ei.useEffect)(()=>{eC&&eS&&!ev&&!em&&ew()},[eC,eS,ev,em]);let ek=(0,ec.CI)(eu.Z("fetchListInflightResponses")),{isLoading:e_,isResolved:eM}=(0,e9.f)((null==n?void 0:n.conversationId)&&!n.isNew?ek(n.conversationId):void 0),eR=(0,ei.useMemo)(()=>N[t],[N,t]),eT=(0,ei.useMemo)(()=>eR?eR.filter(e=>{var t,n;return!(null===(t=e.responseId)||void 0===t?void 0:t.startsWith("streaming_in_progress"))&&!(null===(n=e.responseId)||void 0===n?void 0:n.startsWith("optimistic_query"))}):[],[eR]),eZ=(0,ei.useMemo)(()=>eT?tv.Z(eu.Z("responseId"),eT):{},[eT.map(e=>e.responseId).join(",")]),eO=(0,ei.useMemo)(()=>eT?tf.Z(e=>e.parentResponseId||"",eT):{},[eT.map(e=>e.responseId).join(",")]),[eA,eU]=(0,ei.useState)([]),eL=(0,ei.useCallback)(e=>{let t=[],n=e,s=new Set;for(;n;){var i,a;if(s.has(n.responseId||"")){(0,ee.H)("chat-interaction:getAncestorsWithSiblings","Cycle detected in response hierarchy: ".concat(n.responseId));break}s.add(n.responseId||"");let e=null===(i=eO[null!==(a=n.parentResponseId)&&void 0!==a?a:""])||void 0===i?void 0:i.filter(e=>{var t;return!(null===(t=e.responseId)||void 0===t?void 0:t.startsWith("optimistic"))});if(e?t.unshift(e):t.unshift([n]),!n.parentResponseId)break;n=eZ[n.parentResponseId]}return t},[eO,eZ]);(0,ei.useEffect)(()=>{var e;if(!eh||!j)return;let t=eh.find(e=>e.responseId===j);if(!t)return;let n=eZ[j];if(!n)return;let s=eL(t);eU(null===(e=(0,te.Bv)(n,eZ).map((e,t)=>(Q.some(t=>e===t.responseId)&&(K(void 0),W()),e===(null==eo?void 0:eo.responseId)&&er(void 0),{selectedResponseId:e,siblings:s[t]})).filter(e=>eh.some(t=>t.responseId===e.selectedResponseId)||Q.some(t=>t.responseId===e.selectedResponseId)))||void 0===e?void 0:e.filter(e=>void 0!==e.siblings))},[j,$,null==eh?void 0:eh.map(e=>e.responseId).join(","),null==Q?void 0:Q.map(e=>e.responseId).join(","),eZ,eO,eL]);let ez=(0,ei.useCallback)(async e=>{if(!e)return;let n=tv.Z(eu.Z("responseId"),eR),s=tf.Z(e=>e.parentResponseId||"",eR),i=(0,te.io)(s,e),a=n[i],r=H[i];if(a&&!r&&(r=(await E(t,i,e).catch(e=>((0,ex.xo)(e),[]))).find(e=>e.responseId===i)||void 0),!r){(0,ee.H)("chat-interaction:handlePivotResponse","Failed to find youngest response");return}let o=l.gK.getState();if("streaming"===r.state||"reconnecting"===r.state){o.setLastMessageId(r.parentResponseId),o.setStreamedMessageId(r.responseId);return}if("optimistic"===r.state){o.setLastMessageId(r.parentResponseId),o.setOptimisticMessageId(r.responseId);return}o.setLastMessageId(r.responseId)},[eR,t,C,H]),eP=(0,J.r)(),[eD,eK]=(0,ei.useState)(!1),eH=(0,ei.useRef)(null),eB=(0,ei.useRef)(null),eF=(0,ei.useCallback)(()=>{eW(),Q.length>0&&!M&&X(!0)},[Q.length,M]);(0,ei.useEffect)(()=>{0===Q.length&&X(!1)},[Q.length]);let eW=(0,ei.useCallback)(()=>{setTimeout(()=>{var e;null===(e=eB.current)||void 0===e||e.scrollToBottom("smooth")},0)},[]),e$=(0,ei.useCallback)(e=>{eP||!e||M||X(!0)},[eP,M]),[eq,eY]=(0,ei.useState)(!1);(0,ei.useEffect)(()=>{eY(!1)},[t]),(0,ei.useEffect)(()=>{let e=tm().uniqBy(ep,"responseId");!((null==e?void 0:e.length)<=2)&&Q.length>0&&eY(!0)},[Q.length,ep]);let eJ=(0,ei.useMemo)(()=>{var e;let t=tm().last(eA);if(t)return null===(e=t.siblings)||void 0===e?void 0:e.find(e=>e.responseId===t.selectedResponseId)},[eA]),eQ=(null==eJ?void 0:eJ.sender)==="human",e0=(0,ei.useRef)(void 0);e0.current=eJ;let e1=(0,ei.useCallback)(()=>{var e;let n=H[(null===(e=e0.current)||void 0===e?void 0:e.responseId)||""];if(!n)return;let s=(null==n?void 0:n.sender)==="human";m.logEvent("retry_response",n.responseId,{location:"chat-interaction",responseId:n.responseId||"",conversationId:t});let i=l.gK.getState(),a=ec.CI.getState();s&&a.fetchListInflightResponses(t,!0).then(e=>{e.length?P(t,I.ENABLE_AUTO_STREAM_RETRY).catch(ex.xo):i.sendResponse({message:"",parentResponseId:n.responseId,conversationId:n.conversationId,fileAttachmentIds:n.fileAttachments,webpageUrls:n.webpageUrls,setOpimisticUserResponse:!1,setUserResponse:!1,persona:U,enableRetries:I.ENABLE_AUTO_STREAM_RETRY}).then(e=>{e.length||(0,ee.H)("chat-interaction:handleRetryLeaf:1","Failed to regenerate model response")}).catch(e=>{(0,ee.H)("chat-interaction",e)})}).catch(e=>{(0,ee.H)("chat-interaction",e)});let r=et?a.byId[et]:void 0;if(!s){if(!r)throw Error("Hmm");i.sendResponse({message:r.message,parentResponseId:r.parentResponseId,conversationId:r.conversationId,fileAttachmentIds:r.fileAttachments,webpageUrls:r.webpageUrls,setOpimisticUserResponse:!0,setUserResponse:!0,persona:U,enableRetries:I.ENABLE_AUTO_STREAM_RETRY}).then(e=>{e.length||(0,ee.H)("chat-interaction:handleRetryLeaf:2","Failed to regenerate model response")}).catch(e=>{(0,ee.H)("chat-interaction",e)})}},[U,m,H,t,I.ENABLE_AUTO_STREAM_RETRY]),[e2,e4]=(0,ei.useState)(!1);(0,ei.useEffect)(()=>{o||eg?e4(!0):e4(!1)},[eg,o]);let e3=eQ&&!em&&!e_&&eM&&!d&&(!G||tm().isEmpty(H)),e5=e3||k,e6=(0,ei.useCallback)(e=>{eK(e)},[]),e8=(0,ei.useCallback)(e=>{let t=ec.CI.getState().byId[e];t&&!t.parentResponseId&&eU([])},[]),[e7,tt]=(0,ei.useMemo)(()=>{if(eo)return[eA,[]];let e=eA.findLastIndex(e=>{var t,n;return(null===(n=e.siblings)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.sender)==="human"});return[eA.slice(0,e),eA.slice(e)]},[eA]);(0,ei.useLayoutEffect)(()=>{var e;let t=null===(e=tt[0])||void 0===e?void 0:e.selectedResponseId;t&&O.current&&(x(O.current.getBoundingClientRect().height),y(t))},[tt[0],eo]);let tn=(0,ei.useCallback)(()=>{X(!1)},[]);(0,ei.useLayoutEffect)(()=>{eA.length>2&&eW()},[b]);let ts=(0,ei.useRef)(Q);return((0,ei.useEffect)(()=>{Q&&Q.length>0&&(ts.current=Q)},[Q]),e2)?(0,s.jsx)(tC,{}):(0,s.jsx)(r.S,{FallbackComponent:tD,children:(0,s.jsxs)("div",{ref:eN,className:"relative flex flex-col items-center h-full @container/main",children:[(0,s.jsx)(a.c,{hidden:!0}),(0,s.jsx)(tl.l,{ref:eB,className:(0,tu.cx)("flex flex-col items-center px-5"),stickToBottom:Y,onUnhookScroll:tn,onShowScrollButton:e6,onScroll:e$,children:(0,s.jsxs)("div",{className:(0,tu.cx)("relative w-full flex flex-col items-center pt-20 pb-4"),children:[(0,s.jsx)("div",{ref:eE}),(0,s.jsx)(en.M,{children:ev&&(0,s.jsxs)(es.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1,ease:"easeIn"},className:"text-secondary flex justify-center items-center gap-3 mb-8",children:[c("Loading Older Messages","Loading Older Messages"),(0,s.jsx)(ea.$,{size:"sm"})]},"loading")}),e7.map(e=>{let{selectedResponseId:t,siblings:n}=e;return(0,s.jsx)(tz.E,{responseFamily:n,selectedId:t,onPivotResponse:ez,onEditSubmit:e8,isIncognito:D,queryBarHeight:v,isLastResponse:!1},t)}),(0,s.jsxs)("div",{className:"w-full max-w-3xl flex flex-col",style:{minHeight:eq?"calc(100vh + ".concat(-60+(f>180?f-180:0),"px)"):void 0},ref:eH,children:[tt.map((e,t)=>{let{selectedResponseId:n,siblings:i}=e,a=ts.current.find(e=>e.responseId===n);return(0,s.jsx)("div",{ref:0===t?O:void 0,children:(0,s.jsx)(tz.E,{responseFamily:i,selectedId:n,streamingResponse:a,onPivotResponse:ez,onEditSubmit:e8,isIncognito:D,queryBarHeight:v,isLastResponse:0!==t})},n)}),eo?(0,s.jsxs)("div",{ref:O,children:[(0,s.jsx)(tT,{optimisticResponse:eo,isIncognito:D}),(0,s.jsx)(tL,{optimisticUserResponse:eo})]}):(0,s.jsx)(en.M,{children:Q.length>0&&(0,s.jsx)(es.E.div,{children:(0,s.jsx)(tA,{streamingResponses:Q,usingExperiment:F,onRetry:k?void 0:e1})},"streaming-response")}),e3&&(0,s.jsx)(tk.i,{title:c("Grok was unable to reply.errorMessage","Grok was unable to reply to your last message."),description:c("Grok was unable to reply.description","Please try regenerating a response."),onRetry:k?void 0:e1}),(0,s.jsx)("div",{style:{paddingBottom:v+16,width:"100%"}})]})]})}),(0,s.jsxs)("div",{className:(0,el.cn)("absolute bottom-0 mx-auto inset-x-0",to.c,"z-40"),ref:h,children:[(0,s.jsx)(en.M,{children:eD?(0,s.jsx)(es.E.div,{initial:{opacity:0,y:40,x:"0"},animate:{opacity:1,y:0,x:"0"},exit:{opacity:0,y:40,x:"0"},transition:{opacity:{duration:.1,type:"linear"},x:{duration:.25,type:"spring"},y:{duration:.25,type:"spring"}},className:"absolute flex justify-center w-full h-0 pr-4 mx-auto -top-3",children:(0,s.jsx)("div",{className:(0,el.cn)("h-0 flex items-end justify-end w-full",to.c,"px-2 z-40"),children:(0,s.jsx)(p.zx,{onClick:eF,variant:"outline",size:"icon",className:"rounded-full bg-surface-l2 size-8",children:(0,s.jsx)(u.v4,{size:20,className:"-mb-0.5"})})})}):null}),k&&!I.SHOW_SUBSCRIPTION_FLOWS&&(0,s.jsx)("div",{className:"flex flex-col items-center w-full px-4 pb-4 md:pb-6",children:(0,s.jsxs)("div",{className:(0,tu.cx)("flex flex-col items-center rounded-3xl py-6 px-4 lg:px-24 gap-1","max-w-prose w-full","bg-popover text-center","ring-1 ring-input-border ring-inset"),children:[(0,s.jsx)(ti.Z,{size:32}),(0,s.jsx)("div",{className:"mb-3 text-lg font-semibold",children:c("Message Limit Reached","Message Limit Reached")}),(0,s.jsx)("div",{children:c("Message Limit Reached.description","You've exceeded your messaging allowance for the moment.")}),!R&&(0,s.jsx)("div",{children:(0,s.jsxs)(q.cC,{i18nKey:"Message Limit Reached.loginCta",children:["Login to",(0,s.jsx)(p.zx,{className:"p-1 text-base font-semibold text-breeze",variant:"link",onClick:()=>g.push("/sign-in"),children:"X"}),"to continue the conversation, or try again later."]})}),(null==R?void 0:R.xSubscriptionType)===""&&(0,s.jsx)("div",{children:(0,s.jsxs)(q.cC,{i18nKey:"Message Limit Reached.xLoginCta",children:[(0,s.jsx)(p.zx,{className:"p-1 text-base font-semibold text-breeze",variant:"link",onClick:()=>g.push("/sign-in"),children:"Login"}),"with your Premium X account with the same email address to continue the conversation, or try again later."]})}),(null==R?void 0:R.xSubscriptionType)==="Free"&&(0,s.jsx)("div",{children:(0,s.jsxs)(q.cC,{i18nKey:"Message Limit Reached.upgradeCta",children:["Upgrade to",(0,s.jsx)(p.zx,{className:"p-1 text-base font-semibold text-breeze",variant:"link",onClick:()=>window.location.href="https://verified.x.com/en",children:"X Premium"}),"to continue the conversation, or try again later."]})}),(null==R?void 0:R.xSubscriptionType)==="Premium"&&(0,s.jsx)("div",{children:(0,s.jsxs)(q.cC,{i18nKey:"Message Limit Reached.upgradeMoreCta",children:["Upgrade to",(0,s.jsx)(p.zx,{className:"p-1 text-base font-semibold text-breeze",variant:"link",onClick:()=>window.location.href="https://verified.x.com/en",children:"X Premium+"}),"to continue the conversation, or try again later."]})}),(null==R?void 0:R.xSubscriptionType)==="PremiumPlus"&&(0,s.jsx)("div",{children:c("Slow down a bit!.message","Slow down a bit! You're making a lot of requests. Come back in about an hour to chat again.")})]})}),k&&I.SHOW_SUBSCRIPTION_FLOWS&&(0,s.jsx)("div",{className:"absolute flex flex-col items-center w-full px-4 pb-4 -translate-y-full",children:(0,s.jsxs)("div",{className:"max-w-full @sm:max-w-4/5",children:[!R&&(0,s.jsx)(td.Ye,{}),R&&!Z&&(0,s.jsx)(td.$8,{}),R&&Z&&(0,s.jsx)(td.NT,{})]})}),U&&(0,eX.oe)(U.personaId,c).disclaimer&&!L&&(0,s.jsx)("div",{className:"flex flex-row justify-center px-2",children:(0,s.jsxs)("div",{className:"flex flex-row items-center gap-1 p-1 mb-4 text-center border cursor-pointer w-fit bg-input backdrop-blur-sm ps-3 rounded-3xl pe-3 sm:pe-1",onClick:()=>{z(!0)},children:[(0,s.jsx)("div",{className:"text-xs",children:(0,eX.oe)(U.personaId,c).disclaimer}),(0,s.jsx)(p.zx,{variant:"ghostSecondary",size:"iconSm",onClick:()=>{z(!0)},children:(0,s.jsx)(tg.Z,{size:16})})]})}),(0,s.jsx)(tw,{isIncognito:D,disabled:e5})]})]})})}function tD(e){let{}=e,{t}=(0,q.$G)("chat");return(0,s.jsx)("div",{className:"w-full h-dvh flex justify-center items-center align-middle",children:(0,s.jsxs)("div",{className:"w-full max-w-lg text-center",children:[(0,s.jsx)(ts.r,{route:{page:"main"},className:"mb-6 flex justify-center",children:(0,s.jsx)(o.m3,{height:20,width:60,className:"opacity-80 hover:opacity-100 fill-black dark:fill-white"})}),(0,s.jsx)("div",{children:t("There was an error","There was an error")}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(p.zx,{variant:"primary",size:"md",onClick:()=>{location.reload()},children:t("Reload","Reload")})})]})})}var tG=n(1136),tK=n(76256),tH=n(73358),tB=n(38040),tF=n(39589),tW=n(54596);let t$=tW.z.enum(["deepsearch","brainstorm","analyzeData","createImage","code","search","createReport"]),tq=tW.z.object({prefix:tW.z.string().optional(),prompt:tW.z.string().optional(),label:tW.z.string(),type:t$,icon:tW.z.string().optional()}),tV=tW.z.object({label:tW.z.string(),prompt:tW.z.string().optional(),type:t$,img:tW.z.string().optional(),description:tW.z.string().optional(),prefix:tW.z.string().optional()}),tY=["en"],tX=[{type:"deepsearch",prefix:"Research ",label:"Research"},{type:"createImage",prefix:"Draw ",label:"Create images"},{type:"brainstorm",prefix:"How ",label:"How to"},{type:"analyzeData",prefix:"Help me ",label:"Analyze"},{type:"code",prefix:"Help me ",label:"Code"}],tJ={deepsearch:"deepsearch",brainstorm:"think",analyzeData:"think",createImage:"none",code:"none",search:"none",createReport:"none"},tQ={deepsearch:{},createReport:{},brainstorm:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0},analyzeData:{},createImage:{imageGen:!0},code:{},search:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0}};var t0=n(72802);let t1=()=>{let{t:e}=(0,q.$G)("base"),t=(0,ey.i)(eu.Z("open")),n=(0,ej.useStatsigClient)(),i=(0,ei.useCallback)(()=>{n.logEvent("image_editor_open",void 0,{location:"suggestion-pill"}),t()},[t,n]);return(0,s.jsxs)(t0.M,{tabIndex:0,className:"flex gap-2",onClick:i,children:[(0,s.jsx)(u.NP,{size:18,strokeWidth:2,className:"text-secondary"}),(0,s.jsx)("p",{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:e("Edit Image","Edit Image")})]})};var t2=n(13148),t4=n(40202);let t3=e=>{let{handleSend:t}=e,{t:n}=(0,q.$G)("base"),{personas:i}=(0,eV.HG)(),{user:a}=(0,tI.kP)(),{client:r}=(0,ej.useStatsigClient)(),o=(0,eB.t)(eu.Z("list")),{routeToConversation:d}=(0,eK.o)(),c=(0,l.gK)(eu.Z("setReasoningMode")),{stage:p}=(0,t4.Bn)(),m=(0,eI.F)(eu.Z("setShowAgeVerification")),g=(0,ei.useCallback)(e=>{if(eV.Mh.includes(e.personaId)&&"pass"!==p&&!a){m(!0);return}c("none");let{initialQuery:s,toolOverrides:i,addToLastChat:l}=(0,eX.oe)(e.personaId,n);if(r.logEvent("click_persona",e.personaId,{location:"persona-pill"}),l){let t=o.filter(t=>t.personaId===e.personaId).sort((e,t)=>new Date(t.modifyTime).getTime()-new Date(e.modifyTime).getTime())[0];if(t){d(t.conversationId);return}}t(s,void 0,void 0,i,!1,e)},[c,t,o,m,p,a,r,d,n]);return(0,s.jsxs)(e_.h_,{onOpenChange:e=>{e&&r.logEvent("click_persona_pill",void 0,{location:"persona-pill"})},children:[(0,s.jsx)(e_.$F,{tabIndex:-1,className:"focus:outline-none group",children:(0,s.jsxs)(t5,{children:[n("persona-pill.label","Personas"),(0,s.jsx)(u.v4,{className:"text-secondary group-data-[state=open]:rotate-180 transition-rotate duration-200",size:12})]})}),(0,s.jsx)(e_.AW,{className:"min-w-36 space-y-0.5",children:i.map(e=>{let{icon:t,colorClassName:n}=(0,eX.DB)(e.personaId);return(0,s.jsxs)(e_.Xi,{onClick:()=>g(e),className:"cursor-pointer flex items-center gap-1 ps-1.5",children:[(0,s.jsx)("span",{className:(0,el.cn)("[&>svg]:h-4",n),children:t}),(0,s.jsx)("span",{children:e.name})]},e.personaId)})})]})};function t5(e){let{children:t,...n}=e;return(0,s.jsxs)(t0.M,{tabIndex:0,className:"flex gap-2",...n,children:[(0,s.jsx)(t2.Z,{size:18,strokeWidth:2,className:"text-secondary"}),t]})}var t6=n(65021),t8=n(12363),t7=n(5196),t9=n(73637);function ne(e){let{suggestion:t,onClick:n}=e,{label:i}=t,a=(0,ei.useCallback)(()=>{n(t)},[n,t]);return(0,s.jsxs)(t0.M,{onClick:a,tabIndex:0,children:[(0,s.jsx)(nn,{suggestion:t}),(0,s.jsx)("p",{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:i})]})}function nt(e){let{suggestions:t,onClick:n,handleSend:i}=e,{user:a}=(0,tI.kP)(),r=(0,V.g)(),o=(0,eI.F)(eu.Z("isIncognito")),l=a&&r.SHOW_IMAGE_EDIT&&!o,d=a&&r.ENABLE_WORKSPACES&&!o,c=Math.min(t.length,5)-(l?1:0)-(d?1:0)-1,u=(0,t8.U)(),p=tY.includes(u);return(0,s.jsxs)("div",{className:"flex flex-row flex-wrap w-full gap-2 @sm:gap-2 justify-center items-center",children:[p&&t.slice(0,c).map(e=>{let t=e.type+e.prefix+e.prompt;return(0,s.jsx)(ne,{suggestion:e,onClick:n},t)}),l&&(0,s.jsx)(t1,{}),(0,s.jsx)(t3,{handleSend:i}),d&&(0,s.jsx)(t6.L,{})]})}function nn(e){let{suggestion:t}=e,[n,i]=(0,ei.useState)(!1),[a,r]=(0,ei.useState)(!0);return t.icon&&!n?(0,s.jsxs)(s.Fragment,{children:[a&&(0,s.jsx)(ni,{suggestion:t}),(0,s.jsx)("img",{src:t.icon,alt:"".concat(t.type," icon"),className:"mr-2 h-[18px] w-[18px] object-contain",onError:()=>i(!0),onLoad:()=>r(!1),style:{display:a?"none":"block"}})]}):(0,s.jsx)(ni,{suggestion:t})}let ns={className:"me-2 text-secondary",strokeWidth:2,size:18};function ni(e){let{suggestion:t}=e;switch(t.type){case"deepsearch":return(0,s.jsx)(u.o6,{...ns});case"brainstorm":return(0,s.jsx)(D.Z,{...ns});case"analyzeData":case"createReport":return(0,s.jsx)(t7.Z,{...ns});case"createImage":return(0,s.jsx)(u.Fm,{...ns});case"code":return(0,s.jsx)(t9.Z,{...ns});default:return(0,s.jsx)(s.Fragment,{})}}let na=(e,t)=>{var n,s;let i="",a=0;for(;a<e.length&&(null===(n=e[a])||void 0===n?void 0:n.toLowerCase())===(null==t?void 0:null===(s=t[a])||void 0===s?void 0:s.toLowerCase());)i+=e[a],a++;return i};var nr=e=>{let{suggestion:t}=e,n=t.label||"",i=t.prefix||"",a=n.split(" ").map(e=>({text:e,isHighlighted:!1})),r=i.split(" ");return a=a.map((e,t)=>{if(t>=r.length)return e;let n=r[t].toLowerCase()===e.text.toLowerCase();return{...e,isHighlighted:n}}),(0,s.jsx)(s.Fragment,{children:a.map((e,t)=>{if(t===r.length-1&&e.text.toLowerCase().includes(r[t])){var n;let i=na(e.text,r[t]);return(0,s.jsxs)(ei.Fragment,{children:[(0,s.jsx)("span",{className:"font-medium text-primary",children:i}),(0,s.jsxs)("span",{className:"text-muted-foreground",children:[null===(n=e.text)||void 0===n?void 0:n.slice(null==i?void 0:i.length),"\xa0"]})]},t)}return e.isHighlighted?(0,s.jsxs)("span",{className:"font-medium text-primary",children:[e.text,"\xa0"]},t):(0,s.jsxs)("span",{className:"text-muted-foreground",children:[e.text,"\xa0"]},t)})})};let no=e=>{let{suggestions:t,currentInput:n,onClickSuggestion:i,onKeyboardSelectSuggestion:a,direction:r="column",prefix:o,setPrefix:l,position:d,setPosition:c,incrementSuggestionsShownCount:u}=e;return((0,ei.useEffect)(()=>{if(!n){c(void 0),l("");return}if((null==n?void 0:n.includes("\n"))||(null==o?void 0:o.length)>75)return;let e=e=>{let s=null==t?void 0:t.length;if(!s)return;if("Backspace"===e.key){l(""),c(void 0);return}let i=0;"ArrowDown"===e.key&&(e.preventDefault(),void 0!==d&&(i=(d+1)%s),d===s-1&&(i=void 0)),"ArrowUp"===e.key&&(e.preventDefault(),void 0!==d&&(i=(d-1)%s),0===d&&(i=void 0),void 0===d&&(i=s-1)),("ArrowUp"===e.key||"ArrowDown"===e.key)&&(void 0===i&&a({label:o}),void 0===i||o||l(n),void 0!==i&&a(null==t?void 0:t[i]),c(i)),!(e.key.length>1||e.ctrlKey||e.altKey||e.metaKey||32>e.key.charCodeAt(0))&&/[ -~]/.test(e.key)&&(l(""),c(void 0))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n,d,c,l,a,t,o]),t&&0!==t.length)?(0,s.jsx)(es.E.ul,{className:"pb-2 space-y-2 overflow-hidden bg-background min-h-36",style:{display:"flex",flexDirection:r},children:(0,s.jsx)(en.M,{children:t.map((e,t)=>{let a=(0,s.jsx)(nr,{suggestion:e});return(null==e?void 0:e.img)&&(a=(0,s.jsxs)("span",{className:"text-muted-foreground grid grid-cols-[40px_1fr] gap-4 items-center",children:[(0,s.jsx)("img",{src:null==e?void 0:e.img,alt:"suggestion icon",className:"rounded-sm"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:(0,s.jsx)(nr,{suggestion:e})}),(null==e?void 0:e.description)&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:null==e?void 0:e.description})]})]})),(0,s.jsx)(es.E.li,{className:(0,el.cn)("py-2 cursor-pointer sm:px-3 rounded-xl",d===t?"sm:border-input-border-focus sm:bg-button-ghost-hover":""),onMouseEnter:()=>{void 0===d&&l(n),c(t)},initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20,transition:{duration:.1}},onClick:()=>{var n;return i(null!==(n=e.prompt)&&void 0!==n?n:e.label,null==e?void 0:e.type,t)},transition:{type:"spring",stiffness:700,damping:35,delay:.05*t},onAnimationComplete:()=>{null==u||u()},children:a},t)})})}):null};function nl(){var e;let t=null===(e=(0,V.g)().EXTRA_SUGGESTIONS.value)||void 0===e?void 0:e.extraSuggestions;return(0,ei.useMemo)(()=>t?[...Array.isArray(t)?t.map(e=>tq.safeParse(e)).filter(e=>e.success).map(e=>e.data):[],...tX]:tX,[t])}var nd=n(71636),nc=n(67206);let nu=e=>({ar:"SA",de:"DE",en:"US",es:"ES",fr:"FR",id:"ID",it:"IT",ja:"JP",ko:"KR",nl:"NL",pl:"PL",pt:"PT",ru:"RU",sv:"SE",tr:"TR","uk-UA":"US",vi:"US",zh:"CN","zh-TW":"TW"})[e]||"US",np=e=>({ar:"ar",de:"de",en:"en",es:"es",fr:"fr",id:"en",it:"it",ja:"jp",ko:"ko",nl:"nl",pl:"pl",pt:"pt-pt",ru:"ru",sv:"sv",tr:"tr","uk-UA":"uk",vi:"vi",zh:"zh-hans","zh-TW":"zh-hant"})[e]||"en",nm=tW.z.object({results:tW.z.array(tW.z.object({query:tW.z.string(),img:tW.z.string().optional(),description:tW.z.string().optional()}))}).catch(e=>((0,ee.H)("use-completions",e),{results:[]})),ng=e=>Array.isArray(e)?e.map(e=>tV.safeParse(e)).filter(e=>e.success).map(e=>e.data):[],nh=[{label:"Help me analyze Bitcoin during downturns",prompt:"Analyze the historical performance of Bitcoin during major global economic crises and project its potential behavior in a future downturn.",type:"analyzeData",prefix:"Help me "},{label:"Help me understand successful hedge fund strategies",prompt:"Analyze the 10 most successful options trading strategies used by hedge funds and their risk profiles.",type:"analyzeData",prefix:"Help me "},{label:"Help me predict interest rates",prompt:"Based on X post trends over the last month, what is the probability that the Fed will hold interest rates steady?",type:"analyzeData",prefix:"Help me "},{label:"How can I save on grocery bills each month?",prompt:"Explain how to save money on grocery bills each month for a family of four, step by step. Use a simple analogy, like planning a road trip where you map out the cheapest gas stations and snacks, to show strategies like meal planning, bulk buying, and using coupons.",type:"brainstorm",prefix:"How "},{label:"How would one plan and build a university in 1885?",prompt:"How much would it cost to plan and build a university in 1885?",type:"brainstorm",prefix:"How "},{label:"How would one design and build the Eiffel Tower in 1889?",prompt:"Describe the major engineering challenges and cultural motivations behind constructing the Eiffel Tower in 1889. Include details on the materials and construction techniques used, the societal and artistic influences of the time, and how the project reflected France’s technological ambitions during that era.",type:"brainstorm",prefix:"How "},{label:"Research the best gaming laptop",prompt:"Compare the best gaming laptops under $2,500 for GPU performance, cooling, and battery life.",type:"deepsearch",prefix:"Research "},{label:"Research best home kits for building your own robot",prompt:"What are the best microcontrollers and kits for building a beginner-friendly robot, comparing Arduino, Raspberry Pi, and ESP32?",type:"deepsearch",prefix:"Research "},{label:"Research best running shoes",prompt:"Compare the best running shoes for marathons based on cushioning, durability, and energy return.",type:"deepsearch",prefix:"Research "},{label:"Draw a river otter playing a ukulele",type:"createImage",prefix:"Draw "},{label:"Draw Isaac Newton with an apple falling from his hand",type:"createImage",prefix:"Draw "},{label:"Draw astronauts on the surface of the moon having a picnic in spacesuits",type:"createImage",prefix:"Draw "},{label:"Help me write a function",prompt:"Can you help me write a function? I have the requirements and need assistance with implementation.",type:"code",prefix:"Help me "},{label:"Help me debug my code",prompt:"Can you help me debug my code? I'll share the code snippet with you.",type:"code",prefix:"Help me "},{label:"Help me learn Python",prompt:"Can you help me learn Python? Start by asking me about my current level of programming knowledge.",type:"code",prefix:"Help me "}],nv=(e,t,n)=>("none"===n?nh:nh.filter(e=>{var t,n;return!(null==e?void 0:null===(n=e.label)||void 0===n?void 0:null===(t=n.toLowerCase())||void 0===t?void 0:t.startsWith("draw"))})).filter(t=>{var n;return null==t?void 0:null===(n=t.label)||void 0===n?void 0:n.startsWith(e)}).filter(e=>!t||(null==e?void 0:e.type)===t).map(t=>{var n;return{...t,prefix:e,label:e+(null==t?void 0:null===(n=t.label)||void 0===n?void 0:n.slice(null==e?void 0:e.length))}}),nf=()=>{let e=(0,V.g)(),t=(0,t8.U)(),n=null;return"en"===t&&(n=e.INPUT_SUGGESTIONS),"es"===t&&(n=e.INPUT_SUGGESTIONS_ES),"de"===t&&(n=e.INPUT_SUGGESTIONS_DE),"pt"===t&&(n=e.INPUT_SUGGESTIONS_PT),"fr"===t&&(n=e.INPUT_SUGGESTIONS_FR),"id"===t&&(n=e.INPUT_SUGGESTIONS_ID),"ja"===t&&(n=e.INPUT_SUGGESTIONS_JA),"vi"===t&&(n=e.INPUT_SUGGESTIONS_VI),"zh"===t&&(n=e.INPUT_SUGGESTIONS_ZH),{allDsSuggestions:(0,ei.useMemo)(()=>{var e;return ng(null==n?void 0:null===(e=n.value)||void 0===e?void 0:e.deepsearchModeSuggestions)||[]},[n]),allThinkSuggestions:(0,ei.useMemo)(()=>{var e;return ng(null==n?void 0:null===(e=n.value)||void 0===e?void 0:e.thinkModeSuggestions)||[]},[n])}},nx=e=>{let{prefix:t,type:n="",incrementTypeaheadReqCount:s=()=>{}}=e,i=(0,V.g)(),a=(0,l.gK)(eu.Z("reasoningMode")),r=i.ENABLE_REASONING_MODE_SUGGESTIONS,{allDsSuggestions:o,allThinkSuggestions:d}=nf(),{suggestions:c}=function(e){let{prefix:t,incrementTypeaheadReqCount:n=()=>{}}=e,s=(0,t8.U)(),i=(0,eI.F)(eu.Z("userSettings")),a=(0,t8.U)(),[r,o]=(0,ei.useState)([]),l=(0,nd.N)(t,50),d=(0,V.g)(),c=nl(),u=(0,ei.useMemo)(()=>r.some(e=>t.startsWith(e)),[r,t]),p=(0,ei.useMemo)(()=>c.some(e=>l===e.prefix)&&"en"===s,[c,l,s]),m=!i.preferences.disableTypeahead&&d.ENABLE_BRAVE_COMPLETIONS&&!p&&!u&&l.length>0&&l.length<=400&&l.split(" ").length<=50,{data:g}=(0,nc.aM)({queryKey:["typeahead",a,l],queryFn:async()=>{let e=await function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",n=new URLSearchParams;n.set("q",e),n.set("rich","1"),n.set("lang",np(t)),n.set("country",nu(t));let s=Date.now();return fetch("/search?".concat(n.toString())).then(e=>e.json()).then(nm.parse).then(t=>({source:"brave",msTaken:Date.now()-s,suggestions:t.results.map(t=>({label:t.query,prompt:t.query,prefix:e,type:"search",...t}))}))}(l,a);return null==n||n(),e.suggestions.length||o(e=>[...e,l]),e},enabled:m});return g}({prefix:t,incrementTypeaheadReqCount:s})||{},{isThinkSelected:u,isDeepsearchSelected:p}=(0,e7.NK)();return!t&&p&&r?{suggestions:null==o?void 0:o.slice(0,4)}:!t&&u&&r?{suggestions:null==d?void 0:d.slice(0,4)}:nh.some(e=>t===e.prefix)?{suggestions:nv(t,n,a)}:{suggestions:c||[]}};function nb(e){let{className:t,handleSend:n,position:i,setPosition:a,incrementTypeaheadReqCount:r=()=>{},incrementSuggestionsShownCount:o=()=>{}}=e,d=(0,l.gK)(eu.Z("setReasoningMode")),c=(0,V.g)(),[u,p]=(0,ei.useState)(),[m,g]=(0,ei.useState)(""),h=(0,l.gK)(eu.Z("conversationId"))||"no_conversation_id",v=(0,l.gK)(e=>e.queryByConversationId[h])||"",f=(0,ei.useCallback)(e=>{let{idsetQueryByConversationId:t}=l.gK.getState();t(e,h)},[h]),{isThinkSelected:x,isDeepsearchSelected:b}=(0,e7.NK)(),{client:y}=(0,ej.useStatsigClient)(),{suggestions:I}=nx({prefix:m||v,type:u,incrementTypeaheadReqCount:r});(0,ei.useEffect)(()=>{v||(g(""),p(void 0))},[v]);let j=(0,ei.useCallback)((e,t,s)=>{y.logEvent("click_suggestion",e,{suggestionType:t,location:"chat-autocomplete-suggestions"});let i=tQ[t];c.ENABLE_BRAVE_COMPLETIONS&&-1!==s&&!i&&(i={webSearch:!0}),n(e,void 0,void 0,i,!!c.SUGGESTIONS_USE_CACHE)},[n,y,c.SUGGESTIONS_USE_CACHE]),S=!(0,ei.useMemo)(()=>c.ENABLE_REASONING_MODE_SUGGESTIONS&&(b||x)?!!(null==I?void 0:I.length):!!v,[v,null==I?void 0:I.length,b,x,c.ENABLE_REASONING_MODE_SUGGESTIONS])||!(null==I?void 0:I.length),w=(0,ei.useCallback)(e=>{if(p(e.type),d(tJ[e.type]),e.prefix){var t;let n="".concat(null===(t=e.prefix)||void 0===t?void 0:t.trim()).concat(v?":":"");(null==v?void 0:v.includes(n))||f("".concat(n," ").concat(v))}else e.prompt&&n(e.prompt,void 0,void 0,tQ[e.type],!!c.SUGGESTIONS_USE_CACHE);y.logEvent("click_suggestion_pill",e.label,{suggestionType:e.type,suggestionPrefix:String(e.prefix),suggestionPrompt:String(e.prompt),location:"chat-autocomplete-suggestions:handleClickTile"})},[f,v,n,c.SUGGESTIONS_USE_CACHE,y]),E=nl();return(0,s.jsxs)("div",{className:(0,el.cn)("z-10 w-full @xl:w-4/5 overflow-x-auto no-touch-scrollbar will-change-[mask-image] @sm:[mask-image:none] min-h-10",to.c,t),children:[(0,s.jsx)("div",{className:(0,el.cn)("absolute","bg-background w-full",to.c),children:(0,s.jsx)(no,{currentInput:v,suggestions:I,onClickSuggestion:j,onKeyboardSelectSuggestion:e=>f((null==e?void 0:e.label)||m),prefix:m,setPrefix:g,direction:"column",position:i,setPosition:a,incrementSuggestionsShownCount:o})}),S&&(0,s.jsx)(nt,{suggestions:E,onClick:w,handleSend:n})]})}let ny=e=>{let{suggestions:t,onSelect:n,direction:i="column"}=e;return(null==t?void 0:t.length)?(0,s.jsx)(es.E.ul,{className:"pb-2 space-y-2 overflow-hidden bg-background",style:{display:"flex",flexDirection:i},children:(0,s.jsx)(en.M,{children:t.map((e,t)=>(0,s.jsx)(es.E.li,{className:"py-2 cursor-pointer sm:px-4 rounded-xl sm:hover:border-input-border-focus sm:hover:bg-button-ghost-hover",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20,transition:{duration:.1}},onClick:()=>{var s;return n(null!==(s=e.prompt)&&void 0!==s?s:e.label,e.type,t)},transition:{type:"spring",stiffness:700,damping:35,delay:.1*t},children:(0,s.jsx)(nr,{suggestion:e})},t))})}):null};var nI=n(36183);function nj(e){let{className:t,handleSend:n}=e,[i,a]=(0,ei.useState)(),r=(0,l.gK)(eu.Z("setReasoningMode")),o=(0,V.g)(),{client:d}=(0,ej.useStatsigClient)(),{scrollRef:c,className:u}=(0,nI.m)(),p=(0,l.gK)(eu.Z("conversationId"))||"no_conversation_id",m=(0,l.gK)(eu.Z("idsetQueryByConversationId")),g=(0,l.gK)(e=>e.queryByConversationId[p])||"",h=(0,ei.useCallback)(e=>m(e,p),[p]),{suggestions:v}=nx({prefix:g,type:i});(0,ei.useEffect)(()=>{0===g.length&&a(void 0)},[g]);let f=(0,ei.useCallback)((e,t,s)=>{d.logEvent("click_suggestion",e,{suggestionType:t,location:"chat-prompt-suggestions-new",sugguestion:e,position:String(s)}),a(void 0),n(e,void 0,void 0,tQ[t],!!o.SUGGESTIONS_USE_CACHE)},[n,d,o.SUGGESTIONS_USE_CACHE]),x=(0,ei.useCallback)(e=>{r(tJ[e.type]),e.prefix?(h(e.prefix),a(e.type)):e.prompt&&n(e.prompt,void 0,void 0,tQ[e.type],!!o.SUGGESTIONS_USE_CACHE),d.logEvent("click_suggestion_pill",e.label,{suggestionType:e.type,suggestionPrefix:String(e.prefix),suggestionPrompt:String(e.prompt),location:"chat-prompt-suggestions:handleClickTile"})},[h,g,n,o.SUGGESTIONS_USE_CACHE,d]),b=nl();return(0,s.jsx)("div",{ref:c,className:(0,el.cn)("w-full @xl:w-4/5 overflow-x-auto no-touch-scrollbar",to.c,u,t),children:(null==v?void 0:v.length)>0?(0,s.jsx)(ny,{suggestions:null==v?void 0:v.slice(0,3),onSelect:f}):(0,s.jsx)(nt,{suggestions:b,onClick:x,handleSend:n})})}function nS(){let{t:e}=(0,q.$G)("chat"),t=(0,eI.F)(eu.Z("isIncognito")),n=(0,eG.useSession)().user;if(!(null==n?void 0:n.givenName))return e("Welcome to Grok.","Welcome to Grok.");let s=t?e("Anonymous","Anonymous"):n.givenName,i=new Date().getHours();return i>=5&&i<12?e("Good morning, {{username}}.","Good morning, {{username}}.",{username:s}):i>=12&&i<17?e("Good afternoon, {{username}}.","Good afternoon, {{username}}.",{username:s}):i>=17||i<3?e("Good evening, {{username}}.","Good evening, {{username}}.",{username:s}):e("Hello","Hello")}function nw(){let{t:e}=(0,q.$G)("chat"),t=(0,ei.useRef)(""),{routeToConversation:n,signInWithReturnTo:i}=(0,eK.o)(),{client:a}=(0,ej.useStatsigClient)(),r=(0,V.g)(),o=(0,l.gK)(eu.Z("establishNewConversation")),d=(0,eI.F)(eu.Z("isIncognito")),c=(0,l.gK)(eu.Z("activeModelId")),p=(0,l.gK)(eu.Z("outputMode")),m=(0,l.gK)(eu.Z("reasoningMode")),g=(0,l.gK)(eu.Z("setReasoningMode")),h=(0,tG.ng)(eu.Z("open")),v=(0,eb.O)(eu.Z("listByConversationId")),f=(0,eb.O)(eu.Z("attachListByConversationId")),x=(0,ey.i)(eu.Z("isOpen")),b=v.no_conversation_id||[],y=f.no_conversation_id||[],I=(0,e7.Md)(),j=(0,eC.w)(),S=(0,ei.useMemo)(()=>!d&&r.SHOW_IMAGE_EDIT&&(b.length>0&&!!b.every(e=>e.file.type.includes("image"))||(null==y?void 0:y.length)>0&&!!y.every(e=>e.mimeType.includes("image"))),[b,y,r.SHOW_IMAGE_EDIT,d]),w=(0,ei.useMemo)(()=>!d&&r.SHOW_CREATE_REPORT_BUTTON_ON_ATTACHMENTS&&(b.length>0&&!!b.every(e=>e.metadata&&e.file.type.includes("csv"))||(null==y?void 0:y.length)>0&&!!y.every(e=>e.mimeType.includes("csv"))),[b,y,r.SHOW_CREATE_REPORT_BUTTON_ON_ATTACHMENTS,d]),E=(0,eg.X)(),N=(0,eG.useSession)().user,C=(0,ei.useRef)(null);(0,tB.y)(tH.VM,()=>{var e,t;return null===(t=C.current)||void 0===t?void 0:null===(e=t.getTextArea())||void 0===e?void 0:e.focus()},[]);let{handleKeyDown:k,consumeCompositionTimeMs:_,consumeBackspaceCount:M,consumeAvgKeystrokeLatency:R,consumeKeystrokeCount:T,position:Z,setPosition:O,consumePosition:A,consumeTypeaheadReqCount:U,incrementTypeaheadReqCount:L,incrementSuggestionsShownCount:z,consumeSuggestionsShownCount:P}=tS(),D=(0,ei.useCallback)(async(e,t,s,l,u,g)=>{if(!e)return!1;if(!N&&(!r.ENABLE_ANON_USERS||I.includes(c)))return a.logEvent("sign_in","chat-new",{location:"chat-new"}),i(e,m),!1;let h=eI.F.getState(),v=A(),f=l;(null==r?void 0:r.ENABLE_BRAVE_COMPLETIONS)&&-1!==v&&void 0!==v&&!l&&(f={webSearch:!0});let x={selectedModel:c,fileAttachments:String((null==t?void 0:t.length)||0),webpageUrls:String((null==t?void 0:t.length)||0),location:"chat-new",outputMode:p,toolOverrides:JSON.stringify(f),reasoningMode:m,personalityId:h.userSettings.preferences.selectedSystemPromptId||"",personaId:(null==g?void 0:g.personaId)||"",messageLength:String(e.length),compositionTime:String(_()),backspaceCount:String(M()),avgKeystrokeLatency:String(R()),keystrokeCount:String(T()),position:String(v),typeaheadRequestCount:String(U()),suggestionsShownCount:String(P())};a.logEvent("send_query",e,x),await E();let b=await o({message:e,fileAttachmentIds:t,webpageUrls:s,toolOverrides:f,temporary:d,isPreset:u,persona:g,enableRetries:r.ENABLE_AUTO_STREAM_RETRY}).catch(e=>{(0,ee.H)("chat-new:establishNewConversation",e)});return(null==b?void 0:b.temporary)&&n(null==b?void 0:b.conversationId),!!b},[c,N,r,a,d,p,m]),{modelById:G,defaultAnonModelId:K,defaultFreeModelId:H,defaultProModelId:B,isPending:F}=(0,e7.bP)(),W=(0,l.gK)(eu.Z("setActiveModelId")),{data:$,isPending:Y}=(0,tc.Pd)(),X=r.HIDE_SUBSCRIPTION_FLOWS_FROM_PREMIUM_PLUS_USERS&&(null==N?void 0:N.xSubscriptionType)==="PremiumPlus"||(null==$?void 0:$.hasSubscriptions);(0,ei.useEffect)(()=>{if(F||Y&&N)return;let e=new URLSearchParams(location.search),n=e.get("q"),s=e.get("reasoningMode"),i=e.get("fileid");if(X&&B&&G[B]?W(B):N&&H&&G[H]?W(H):K&&G[K]&&W(K),s){let e=tF.DT.parse(s);e&&g(e)}let{setUsingExperiment:a}=l.gK.getState();a(!1),n&&!t.current&&(D(n,i?[i]:void 0,[]).catch(e=>{(0,ee.H)("chat-new:mount:handleSend",e)}),t.current="auto-start")},[F,Y]);let J=(0,ei.useCallback)(function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];D(...t).catch(e=>{(0,ee.H)("chat-new:handleClickSuggestion",e)})},[D]),Q=(0,ei.useCallback)(()=>{let t=[...b.map(e=>e.metadata).filter(e=>e&&!(e instanceof Error)).map(e=>e.fileMetadataId),...y.map(e=>e.assetId)];D(e("create-report-prompt","Create a report"),t).catch(e=>{(0,ee.H)("chat-new:handleClickCreateReport",e)})},[D,b,y,e]);return(0,s.jsxs)("div",{className:"flex flex-col items-center w-full h-full p-2 mx-auto justify-center @sm:p-4 @sm:gap-9 @xl:w-4/5 isolate",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center gap-6 @sm:gap-9 h-[450px] w-full @sm:pt-12 isolate",children:[(0,s.jsxs)("div",{className:(0,el.cn)("flex flex-col items-start justify-center w-full @sm:px-4 px-2 gap-6 @sm:gap-4 @xl:w-4/5 flex-initial pb-0",to.c),children:[(0,s.jsxs)("h1",{className:"w-full text-2xl flex-col tracking-tight @sm:text-3xl text-primary flex items-center justify-center text-center",children:[(0,s.jsx)(nS,{}),(0,s.jsx)("span",{className:"text-secondary",children:e("How can I help you today?","How can I help you today?")})]}),j&&(0,s.jsx)(nj,{className:(0,el.cn)("@sm:hidden",{invisible:d}),handleSend:J})]}),(0,s.jsxs)("div",{className:(0,el.cn)("absolute bottom-0 mx-auto inset-x-0",to.c,"@sm:relative flex flex-col items-center w-full gap-1 @sm:gap-5 @sm:bottom-auto @sm:inset-x-auto @sm:max-w-full"),children:[(0,s.jsxs)("div",{className:(0,el.cn)("flex flex-col-reverse items-center justify-between flex-1 w-full gap-0 @sm:gap-5 @sm:flex-col relative","p-2 @sm:p-0"),children:[(0,s.jsx)(ty.B,{className:"mt-2",textAreaClassName:"min-h-14 pt-5 my-0 mb-5",placeholder:e("queryBarPlaceholders",{returnObjects:!0}),onQuery:D,onFrontPage:!x,ref:C,isIncognito:d,onKeyDown:k},"query-bar"),(0,s.jsxs)(en.M,{mode:"popLayout",initial:!1,children:[r.SHOW_IMAGE_EDIT&&S&&!d&&(0,s.jsx)(es.E.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"bg-background rounded-full",children:(0,s.jsxs)(tb.d,{shouldGetFromStore:!0,buttonProps:{variant:"card",size:"pill"},location:"chat-new-input",className:"py-3 px-4 h-auto",children:[(0,s.jsx)(u.NP,{className:"size-5 text-secondary"}),e("Edit Image","Edit Image")]})},"edit"),w&&!d&&(0,s.jsx)(es.E.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"bg-background rounded-full",children:(0,s.jsx)(ne,{suggestion:{type:"createReport",label:e("create-report","Create Report")},onClick:Q})},"edit"),!j&&!S&&!w&&(0,s.jsx)(es.E.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"w-full flex justify-center",children:(0,s.jsx)(nb,{className:(0,el.cn)("hidden @sm:block overflow-visible",d&&"invisible"),handleSend:J,position:Z,setPosition:O,incrementTypeaheadReqCount:L,incrementSuggestionsShownCount:z})},"suggestions")]})]}),N?null:(0,s.jsx)("div",{className:"text-[11px] @sm:text-xs text-secondary text-nowrap",children:(0,s.jsx)(q.cC,{ns:"chat",i18nKey:"clickwrapAgreement",defaults:"By messaging Grok, you agree to our <terms>Terms</terms> and <policy>Privacy Policy</policy>.",components:{terms:(0,s.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/terms-of-service",target:"_blank",rel:"noopener noreferrer"}),policy:(0,s.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/privacy-policy",target:"_blank",rel:"noopener noreferrer"})}})})]})]}),!X&&r.SHOW_SUBSCRIPTION_FLOWS&&!h&&(0,s.jsx)(tK.Ej,{})]})}var nE=n(82724),nN=n(23780);let nC=e=>!!(null==e?void 0:e.thinkingStartTime)||!!(null==e?void 0:e.searchingStartTime),nk=()=>{let{t:e}=(0,q.$G)("base"),t=(0,V.g)(),[n,i]=(0,ei.useState)(""),[a,r]=(0,ei.useState)(0),o=(0,l.gK)(e=>null==e?void 0:e.lastMessageId),d=(0,l.gK)(e=>null==e?void 0:e.streamedMessageId),c=(0,ec.CI)(e=>{var t;return null==e?void 0:null===(t=e.byId)||void 0===t?void 0:t[o||""]}),u=(0,ec.CI)(e=>{var t;return null==e?void 0:null===(t=e.byId)||void 0===t?void 0:t[d||""]}),[p,m]=(0,ev._)("notifications-ask-count",0),g=(0,eI.F)(e=>e.userSettings.preferences.browserNotificationsEnabled);(0,ei.useEffect)(()=>{if(0===a||g)return;let e=setTimeout(()=>r(e=>e+1e3),1e3);return()=>clearTimeout(e)},[a]),(0,ei.useEffect)(()=>{if(!g&&nC(u)){if((null==u?void 0:u.state)==="streaming"){r(1e3);return}(null==c?void 0:c.state)==="closed"&&r(0)}},[null==u?void 0:u.state,null==c?void 0:c.state]),(0,ei.useEffect)(()=>{let e=a>=6e3&&a<7e3;!n&&!g&&e&&!(p>=2)&&(null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS)&&(i((0,eS.Am)((0,s.jsx)(n_,{onDismiss:h}),{duration:1/0,className:"inset-x-0 mx-auto"})),m(p+1))},[n,a]),(0,ei.useEffect)(()=>{g&&((null==c?void 0:c.thinkingStartTime)||(null==c?void 0:c.searchingStartTime))&&(null==c?void 0:c.state)==="closed"&&v()},[c]);let h=()=>{eS.Am.dismiss(n),i("")},v=()=>{var n;if((null===(n=document)||void 0===n||!n.hasFocus())&&(null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS)){if(null==u?void 0:u.searchingStartTime){new Notification(e("notifications_answer_ready_search",'Your "DeepSearch" answer is ready'));return}new Notification(e("notifications_answer_ready",'Your "Think" answer is ready'))}};return v},n_=e=>{let{onDismiss:t=()=>{}}=e,{t:n}=(0,q.$G)("base"),[i,a]=(0,ei.useState)("ASK"),r=(0,eI.F)(eu.Z("fetchSetPreference")),o=async()=>{if("granted"===Notification.permission||(a("WAIT"),"granted"===await Notification.requestPermission())){a("ALLOWED"),await r("browserNotificationsEnabled",!0);return}a("DENIED")};return((0,ei.useEffect)(()=>{if("ASK"===i){let e=setTimeout(()=>t(),4e3);return()=>clearTimeout(e)}if("WAIT"===i)return;let e=setTimeout(()=>t(),2e3);return()=>clearTimeout(e)},[i]),(0,J.T)()||"DENIED"===i)?null:"ALLOWED"===i?(0,s.jsxs)("div",{className:"flex items-center gap-4 min-w-[348px]",children:[(0,s.jsx)(eY.Z,{className:"size-5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold",children:n("notifications_enabled_title","Notifications enabled")}),(0,s.jsx)("div",{className:"text-xs text-secondary",children:n("notifications_enabled_subtitle","We'll keep you updated")})]})]}):(0,s.jsxs)("div",{className:"flex justify-between items-center gap-4 relative group min-w-[348px]",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(nN.Z,{className:"size-5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold",children:n("notifications_ask_title","Get notified when answer ready")}),(0,s.jsx)("div",{className:"text-xs text-secondary",children:n("notifications_ask_subtitle","Enable notifications")})]})]}),(0,s.jsx)(p.zx,{className:"rounded-xl px-2 py-2",variant:"secondary",disabled:"WAIT"===i,onClick:o,children:n("notifications_enable","Enable")})]})},nM=[];function nR(){let e=(0,ta.useSearchParams)(),{t}=(0,q.$G)("chat"),{client:n}=(0,ej.useStatsigClient)(),{attachFiles:o}=(0,e8.GC)(),d=(0,V.g)(),{user:c}=(0,eG.useSession)(),u=(0,eb.O)(eu.Z("listByConversationId")),p=(0,l.gK)(eu.Z("optimisticConversationId")),m=(0,l.gK)(eu.Z("conversationId")),g=(0,eB.t)(eu.Z("fetchGetConversation")),h=(0,l.gK)(eu.Z("setUsingExperiment")),v=(0,l.gK)(eu.Z("reconnectToInflightResponses")),f=(0,eI.F)(e=>e.userSettings.preferences.showActiveTabs),x=u[m||"no_conversation_id"]||nM;nk();let b=(0,ta.useRouter)(),y=(0,ei.useRef)(!1),I=e.get(e6.$Y);(0,ei.useEffect)(()=>{if(!y.current&&I){setTimeout(()=>eS.Am.success(t("oauth.connection.success","Successfully connected {{provider}}!",{provider:tn(I)})),0),y.current=!0;let e=new URL(window.location.href);e.searchParams.delete(e6.$Y),b.replace("".concat(e.pathname).concat(e.search).concat(e.hash,"/"),{scroll:!1})}},[I,b,t]);let{data:j,isLoading:S,error:w}=(0,e9.f)(m?g(m):void 0),E=(0,eB.t)(e=>j?e.byId[j.conversationId]:void 0);(0,ei.useEffect)(()=>{document.title=(null==E?void 0:E.title)?"".concat(E.title," - Grok"):"Grok"},[I,E]),(0,ei.useEffect)(()=>{l.gK.getState().setChatPageLoaded(!0)},[]);let[N,C]=(0,ei.useState)(!1);(0,ei.useEffect)(()=>{if(!(null==j?void 0:j.conversationId))return;j.isNew||(C(!0),v(j.conversationId,d.ENABLE_AUTO_STREAM_RETRY).catch(ex.xo).finally(()=>C(!1)));let e=ec.CI.getState();h(!1),e.loadInitialResponses(j.conversationId).then(e=>{var t;let n=l.gK.getState();if(n.conversationId===(null===(t=e[0])||void 0===t?void 0:t.conversationId)){let t=(0,te.xt)(e);if(!t){n.setLastMessageId(void 0);return}if("streaming"===t.state||"reconnecting"===t.state){n.setLastMessageId(t.parentResponseId),n.setStreamedMessageId(t.responseId);return}if("optimistic"===t.state){n.setLastMessageId(t.parentResponseId),n.setOptimisticMessageId(t.responseId);return}n.setLastMessageId(t.responseId)}}).catch(ex.xo)},[null==j?void 0:j.conversationId]);let k=(0,l.gK)(eu.Z("activeModelId")),{modelById:_}=(0,e7.bP)(),M=null==_?void 0:_[k],{isAttachDisabled:R,isThinkSelected:T,isDeepsearchSelected:Z}=(0,e7.NK)(M),O=(0,tt._)(()=>({accept:[tr.FILE],drop:e=>{c&&(o(e.files),e.files.forEach(e=>{n.logEvent("upload_file",e.name,{location:"file-drop",mimeType:e.type})}))},collect:e=>!!e.isOver(),canDrop:e=>!R&&!!e.files.length&&(!x.length||!x.find(t=>t.file.name===e.files[0].name))}),[x,c,R,o]);return(0,s.jsx)(r.S,{fallbackRender:nZ,children:(0,s.jsxs)("main",{className:(0,el.cn)("h-dvh flex-grow flex-shrink relative selection:bg-highlight w-0","@container isolate"),children:[(0,s.jsx)(a.c,{hidden:!0}),(0,s.jsx)(en.M,{children:O&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(es.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-overlay z-50"},"drop-backdrop"),(0,s.jsx)(es.E.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:20},className:"fixed inset-0 z-50 flex items-center justify-center p-6 pointer-events-none",children:c?R?(0,s.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,s.jsx)("div",{children:(0,s.jsx)(ti.Z,{size:32,className:"text-red-400"})}),(0,s.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:t("Attachments are disabled","Attachments are disabled")}),(0,s.jsxs)("p",{className:"text-secondary",children:[t("Attachments are disabled for","Attachments are disabled for")," ",(0,s.jsx)("span",{className:"font-semibold",children:T?"Think":Z?"DeepSearch":void 0})]})]}):(0,s.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,s.jsx)("div",{children:(0,s.jsx)(eZ.Z,{size:32,className:"text-secondary"})}),(0,s.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:t("Drop your files here","Drop your files here")}),(0,s.jsx)("p",{className:"text-secondary",children:t("Drop your files here to add them to your conversation","Drop your files here to add them to your conversation")})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center w-full max-w-xl py-12 border-4 border-red-400 border-dashed rounded-2xl bg-background",children:[(0,s.jsx)("div",{children:(0,s.jsx)(eZ.Z,{size:32,className:"text-secondary"})}),(0,s.jsx)("h2",{className:"mt-4 mb-2 text-lg font-medium text-red-400",children:t("Sign in to attach files!","Sign in to attach files!")}),(0,s.jsx)("p",{className:"text-secondary",children:t("You must be signed in to attach files to your conversation","You must be signed in to attach files to your conversation")})]})},"drop-modal")]})}),(0,s.jsx)(nE.ChatTopNav,{conversationIsLoading:S,conversation:j||void 0,isOptimisticConversation:!!p}),(0,s.jsx)(i.CommandMenu,{}),p?(0,s.jsx)(tP,{conversationId:p,conversation:void 0,isOptimisticConversation:!0,conversationIsLoading:S,conversationError:w},"chat-interaction"):m?(0,s.jsx)(tP,{conversationId:m,conversation:j||void 0,isOptimisticConversation:!1,conversationIsLoading:S,conversationError:w,isReconnecting:N},"chat-interaction"):!m&&!p&&(0,s.jsx)(nw,{}),(0,s.jsx)(eD,{}),d.ENABLE_CONVERSATION_TABS&&f&&(0,s.jsx)(e3,{})]},"chat-page")})}function nT(e){let{}=e,{t}=(0,q.$G)("chat");return(0,s.jsx)("div",{className:"w-full h-dvh flex justify-center items-center align-middle",children:(0,s.jsxs)("div",{className:"w-full max-w-lg text-center",children:[(0,s.jsx)(ts.r,{route:{page:"main"},className:"mb-6 flex justify-center",children:(0,s.jsx)(o.m3,{height:20,width:60,className:"opacity-80 hover:opacity-100 fill-black dark:fill-white"})}),(0,s.jsx)("div",{children:t("There was an error","There was an error")}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(p.zx,{variant:"primary",size:"md",onClick:()=>{window.location.href="/"},children:t("Return to Home","Return to Home")})})]})})}function nZ(e){let{error:t,resetErrorBoundary:n}=e;return(0,s.jsx)(nT,{error:t,reset:n})}},9682:function(e,t,n){n.d(t,{d:function(){return v}});var s=n(2899),i=n(76038),a=n(34116),r=n(87678),o=n(49810),l=n(72242),d=n(41307),c=n(10090),u=n(74239),p=n(56672),m=n(4694),g=n(70702),h=n(78394);let v=e=>{let{conversationId:t,shouldGetFromStore:n=!1,editingImage:v,className:f,buttonProps:x,location:b,children:y,onClick:I}=e,{t:j}=(0,g.$G)("base"),{ASSET_SERVER_URL:S}=(0,i.O)(),w=(0,c.i)(p.Z("open")),E=(0,d.O)(p.Z("listByConversationId")),N=(0,d.O)(p.Z("attachListByConversationId")),{client:C}=(0,u.useStatsigClient)(),k=E[null!=t?t:"no_conversation_id"],_=N[null!=t?t:"no_conversation_id"],M=(0,m.useMemo)(()=>{var e,t;return(null==k?void 0:k[0])&&(null==k?void 0:null===(e=k[0])||void 0===e?void 0:e.metadata)?null==k?void 0:null===(t=k[0])||void 0===t?void 0:t.metadata:(null==_?void 0:_[0])?(0,h.I)(null==_?void 0:_[0]):void 0},[k,_]),R=(0,m.useMemo)(()=>{if(!(M instanceof Error))return null==M?void 0:M.fileUri},[M]),T=(0,m.useMemo)(()=>n&&!(M&&!(M instanceof Error)),[n,M]),Z=(0,m.useCallback)(e=>{e.stopPropagation(),!n||!M||M instanceof Error?v&&w(v):w({metadata:M,url:(0,o.Vh)(S,R)});let t=v&&"assetKey"in v?v.assetKey:R||"";C.logEvent("image_editor_open",(0,r.s)(t||""),{location:b||""}),I&&I(e)},[n,v,M,R,I,C,t]);return(0,s.jsx)(a.zx,{...x,"aria-label":j("Edit image","Edit image"),disabled:T,className:(0,l.cn)("bg-surface-l2 hover:bg-warm-gray-100 dark:hover:bg-surface-l3",!T&&"*:hover:text-primary *:hover:transition-colors",f),onClick:Z,children:y})}},40794:function(e,t,n){n.d(t,{_:function(){return l},o:function(){return c}});var s=n(2899),i=n(4694),a=n(13341),r=n(15419);let o=(0,i.createContext)(null);function l(e,t){let n=(0,i.useContext)(o);if(!n)throw Error("Add GlobalFileDropProvider when using useGlobalFileDrop");let s=(0,i.useRef)(Symbol("useGlobalFileId")),{collectedProps:a,hookId:r,subscribe:l}=n;return(0,i.useEffect)(()=>{if(r&&r!==s.current){console.warn("Other component already taken over GlobaFileDropProvider");return}return l({options:"function"==typeof e?e():e,hookId:s.current}),()=>{l(null)}},[l,...null!=t?t:[]]),a}let d={accept:[r.FILE]};function c(e){var t,n;let{className:r,children:l}=e,[c,u]=(0,i.useState)(null),p=(0,i.useRef)(null),m=null!==(t=null==c?void 0:c.options)&&void 0!==t?t:d,[g,h]=(0,a.L)(m);h(p);let v=null!==(n=null==c?void 0:c.hookId)&&void 0!==n?n:null,f=(0,i.useMemo)(()=>({collectedProps:g,hookId:v,subscribe:u}),[g,u,v]);return(0,s.jsx)("div",{ref:p,className:r,"data-testid":"global-drop",children:(0,s.jsx)(o.Provider,{value:f,children:l})})}}}]);